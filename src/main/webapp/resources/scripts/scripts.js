"use strict";angular.module("geocoder",["ngStorage"]).factory("Geocoder",["$localStorage","$q","$timeout","$rootScope",function(a,b,c,d){var e=a.locations?JSON.parse(a.locations):{},f=[],g=250,h=function(){var b=f[0],i=new google.maps.Geocoder;i.geocode({address:b.address},function(i,j){if(j===google.maps.GeocoderStatus.OK){var k={lat:i[0].geometry.location.lat(),lng:i[0].geometry.location.lng(),formattedAddress:i[0].formatted_address};e[b.address]=k,a.locations=JSON.stringify(e),f.shift(),b.d.resolve(k)}else j===google.maps.GeocoderStatus.ZERO_RESULTS?(f.shift(),b.d.reject({type:"zero",message:"Zero results for geocoding address "+b.address})):j===google.maps.GeocoderStatus.OVER_QUERY_LIMIT?b.executedAfterPause&&(f.shift(),b.d.reject({type:"busy",message:"Geocoding server is busy can not process address "+b.address})):j===google.maps.GeocoderStatus.REQUEST_DENIED?(f.shift(),b.d.reject({type:"denied",message:"Request denied for geocoding address "+b.address})):(f.shift(),b.d.reject({type:"invalid",message:"Invalid request for geocoding: status="+j+", address="+b.address}));if(f.length)if(j===google.maps.GeocoderStatus.OVER_QUERY_LIMIT){var l=f[0];l.executedAfterPause=!0,c(h,g)}else c(h,0);d.$$phase||d.$apply()})};return{geocodeAddress:function(a){var c=b.defer();return _.has(e,a)?c.resolve(e[a]):(f.push({address:a,d:c}),1===f.length&&h()),c.promise}}}]),angular.module("decimalformat",[]).factory("DecimalFormat",function(){function a(a){this.prefix="",this.suffix="",this.comma=0,this.minInt=1,this.minFrac=0,this.maxFrac=0;for(var b=0;b<a.length;b++)if("#"==a.charAt(b)||"0"==a.charAt(b)){this.prefix=a.substring(0,b),a=a.substring(b);break}this.suffix=a.replace(/[#]|[0]|[,]|[.]/g,"");var c=a.replace(/[^0#,.]/g,""),d="",e="",f=c.indexOf(".");-1!=f?(d=c.substring(0,f),e=c.substring(f+1)):d=c;var g=d.lastIndexOf(",");-1!=g&&(this.comma=d.length-1-g),d=d.replace(/[,]/g,""),e=e.replace(/[,]|[.]+/g,""),this.maxFrac=e.length;var h=d.replace(/[^0]/g,"");h.length>this.minInt&&(this.minInt=h.length),h=e.replace(/[^0]/g,""),this.minFrac=h.length}return a.prototype.format=function(a){var b=this.formatBack(a).toLowerCase();if(isNaN(b)||0==b.length)return a;if(o=-1!=b.indexOf("e")){var c=Number(b);if("Infinity"==c||"-Infinity"==c)return b;if(b=c+"",-1!=b.indexOf("e"))return b}var d=!1;"-"==b.charAt(0)?(d=!0,b=b.substring(1)):"+"==b.charAt(0)&&(b=b.substring(1));var e=b.indexOf("."),f="",g="";-1!=e?(f=b.substring(0,e),g=b.substring(e+1)):f=b,g=g.replace(/[.]/,"");var h=this.suffix&&"%"===this.suffix.charAt(0),i=this.minInt,j=this.minFrac,k=this.maxFrac;if(h&&(i-=2,j+=2,k+=2),g.length>k){var l=new Number("0."+g);l=0==k?Math.round(l):l.toFixed(k),g=l.toString(10).substr(2);for(var m,n=l>=1?1:0,o=f.length-1;n;){if(-1==o){f="1"+f;break}m=f.charAt(o),9==m?(m="0",n=1):(m=++m+"",n=0),f=f.substring(0,o)+m+f.substring(o+1,f.length),o--}}for(var o=g.length;j>o;o++)g+="0";for(;g.length>j&&"0"==g.charAt(g.length-1);)g=g.substring(0,g.length-1);for(var o=f.length;i>o;o++)f="0"+f;for(;f.length>i&&"0"==f.charAt(0);)f=f.substring(1);h&&(f+=g.substring(0,2),g=g.substring(2));for(var p=0,o=f.length;o>0;o--)0!=p&&p%this.comma==0&&(f=f.substring(0,o)+","+f.substring(o),p=0),p++;var q;return q=g.length>0?this.prefix+f+"."+g+this.suffix:this.prefix+f+this.suffix,d&&(q="-"+q),q},a.prototype.formatBack=function(a){if(a+="",!a)return"";if(!isNaN(a))return this.getNumericString(a);var b=a,c=!1;"-"==a.charAt(0)&&(b=b.substr(1),c=!0);var d=b.indexOf(this.prefix),e=""==this.suffix?b.length:b.indexOf(this.suffix,this.prefix.length+1);return 0==d&&e>0&&(b=b.substr(0,e),b=b.substr(this.prefix.length),b=b.replace(/,/g,""),c&&(b="-"+b),!isNaN(b))?this.getNumericString(b):a},a.prototype.getNumericString=function(a){var b=new Number(a),c=b+"";if(a.indexOf(".")>-1&&c.indexOf(".")<0){for(var d=a.indexOf(".")+1;d<a.length;d++)if("0"!==a.charAt(d))return a;return c}return a},a}),angular.module("skyGiraffeApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","angular.filter","ui.bootstrap","uiGmapgoogle-maps","kendo.directives","uuid4","ngStorage","geocoder","decimalformat","toggle-switch","tc.chartjs"]).config(["$routeProvider","$httpProvider","uiGmapGoogleMapApiProvider",function(a,b,c){a.when("/apps/:app_id/reports",{templateUrl:"views/reports.html",controller:"ReportsCtrl"}).when("/apps/:app_id/reports/:report_id",{templateUrl:"views/report.html",controller:"ShowReportCtrl"}).when("/apps/:app_id/reports/:report_id/tabs/:tab_id",{templateUrl:"views/report.html",controller:"ShowReportCtrl"}).when("/login",{templateUrl:"views/login.html",controller:"NewSessionCtrl"}).when("/logout",{templateUrl:"views/login.html",controller:"DestroySessionCtrl"}).when("/restore",{templateUrl:"views/restore.html",controller:"CredentialsRestoreCtrl"}).otherwise({redirectTo:"/login"}),b.interceptors.push("AuthInterceptor"),b.interceptors.push("ErrorInterceptor"),b.interceptors.push("httpInterceptor"),c.configure({client:GOOGLE_MAPS_CLIENT,v:"3.23",libraries:"geometry,visualization"})}]).run(["$rootScope","$location","$http","$window","User","App","SGConfig",function(a,b,c,d,e,f,g){a.$on("$locationChangeStart",function(a,c,d){var g=a.targetScope.userLoggedIn=e.isLoggedIn();g?a.targetScope.apps=f.records:"/login"!=c.slice(-6)&&"/restore"!=c.slice(-8)&&b.path("/login")}),setInterval(function(){e.isLoggedIn()&&c({url:g.urls.apps,data:{},method:"POST"})},24e4)}]),angular.module("skyGiraffeApp").factory("SGConfig",["$rootScope","$location","$localStorage",function(a,b,c){var d=function(){};return d.version="5006004",d.getEnvironment=function(){var a=b.host();return"localhost"==a||"sgwaqa.azurewebsites.net"==a||"main.project.ok"==a?"development":"production"},d.getBaseUrl=function(){if(c.baseUrl)return c.baseUrl;var a={production:PRODUCTION_SERVER,development:"https://sgwin2012r2.skygiraffe.com/SGWSPublisher/WSPublisherV2.svc"},b=d.getEnvironment();return a[b]},d.setUrls=function(){var a=d.getBaseUrl();d.urls={auth:a+"/Authenticate",apps:a+"/GetAppsList",regularReport:a+"/GetReport_regular4",parametersForReport:a+"/GetReport_ParametersMainScreen4",parameterizedReport:a+"/GetReport_Parameterized4",parameterizedParameter:a+"/GetParameterizedParameterData4",updateData:a+"/Send_Write_Back_Request",updateDataStatus:a+"/CheckWriteBackStatus",getAction:a+"/GetActionData4",restorePassword:a+"/ForgotPassword",updatePassword:a+"/UpdateLoginPassword",resetPassword:a+"/ResetLoginPassword",dashboardLayout:a+"/GetDashboardLayout"}},d.setBaseUrl=function(a){c.baseUrl=a,d.setUrls()},d.setUrls(),d.useHttps=function(){return!!USE_HTTPS},d.statuses={51017:{isValid:!1,message:"Version is not supported."},51018:{isValid:!0,message:"Version is supported, but is not the latest."},51019:{isValid:!0,message:"Version is the latest."},51020:{isValid:!0,message:"Version is newer than the latest, table needs to be updated."},51025:{isValid:!0,message:"The mobile is updated with the latest meta data, nothing was sent."},51026:{isValid:!0,message:"New Meta data was sent the the mobile app."},51027:{isValid:!0,message:"The mobile is updated with the latest data, nothing was sent."},51028:{isValid:!0,message:"New data was sent the the mobile app."},51029:{isValid:!0,message:"Report without DataItem."},51059:{isValid:!0,message:"Report meta data and data was published to mobile."},51060:{isValid:!0,message:"Report meta data was published to mobile."},51061:{isValid:!0,message:"The mobile has the most updated meta data and data."},51062:{isValid:!0,message:"New data was sent to the mobile."},51041:{isValid:!0,message:"Report with parameterized DataItem success."},51068:{isValid:!0,message:"Action is updated."},51067:{isValid:!0,message:"Action is updated."},51069:{isValid:!0,message:"Action has new data."},51043:{isValid:!1,message:"Report with parameterized DataItem failed."},51066:{isValid:!1,message:"Report Does Not Exists."},51075:{isValid:!0,message:"No Data Is Required."},51077:{isValid:!0,message:"The mobile already has the latest data - only parameters definitions are sent."},51078:{isValid:!0,message:"New data for Report main screen was sent to the mobile."},51084:{isValid:!0,message:"The mobile is not updated, meta data and data are sent."},51085:{isValid:!0,message:"The mobile has the latest data, only meta data is sent."},51086:{isValid:!0,message:"The mobile has the latest meta data and data, nothing is sent."},51087:{isValid:!0,message:"The mobile has the latest meta data, only data is sent."},51091:{isValid:!0,message:"Password is about to expire warning."},51090:{isValid:!1,message:"The Password is expired, user must change password."},1:{isValid:!0,message:"Successful login, mobile didn't send version."},0:{isValid:!1,message:"Login failed. Please check your username and password."},"-1":{isValid:!1,message:"Session expired. Please log in again."}},d.pollStatuses={0:"pending",1:"pending",2:"pending",3:"success",4:"failure"},d.colorTranslations={"#21b6db":"#66BBDB","#9a1c4f":"#F1756D","#ef8a21":"#FFB967","#b2d235":"#78D4CC","#037078":"#5889A2","#0A939D":"#BBB4E0"},d.chartColors=["#D7D3EC","#507F98","#83C7C8","#5749AA","#A962D0","#151228","#A298D5","#54AAAB","#306162","#D5ECEC","#9888BF","#49357A","#64B8CB","#7B6FC1","#5C516B","#BA93EF","#48C4D5","#3D82AF"],d.validateStatus=function(a){var b=d.statuses[a];return"undefined"==typeof b&&(b={isValid:!1,message:"An unknown error has occurred (status code: "+a+")"}),b},d.alert=function(b,c,d){a.$broadcast("alert",{message:b,type:c,"float":d})},d.log=function(a){var b=d.getEnvironment();"development"==b&&console.log(a)},d}]),angular.module("skyGiraffeApp").factory("AuthInterceptor",["$rootScope","$q","$window","$location","SGConfig",function(a,b,c,d,e){return{request:function(a){return a.headers=a.headers||{},a.data=a.data||{},c.sessionStorage.token&&(a.data.SessionID=c.sessionStorage.token),a}}}]),angular.module("skyGiraffeApp").factory("ErrorInterceptor",["$rootScope","$q","$window","$location","SGConfig",function(a,b,c,d,e){var f={response:function(a){return"undefined"!=typeof a.data.Status&&g(a),a||b.when(a)},responseError:function(a){return e.alert("Server error ("+a.status+"): "+a.statusText,"error"),b.reject(a)}},g=function(a){var b=e.validateStatus(a.data.Status);b.isValid||("-1"==a.data.Status&&(delete c.sessionStorage.token,d.path("/login")),5==a.data.Status[0]?e.alert(b.message,"error"):e.alert(a.data.Msg,"error","floating"))};return f}]),angular.module("skyGiraffeApp").factory("httpInterceptor",["$q","$rootScope","$log",function(a,b,c){var d=0;return{request:function(c){return d++,b.$broadcast("loading-start"),c||a.when(c)},response:function(c){return 0===--d&&b.$broadcast("loading-end"),c||a.when(c)},responseError:function(c){return--d||b.$broadcast("loading-end"),a.reject(c)}}}]),angular.module("skyGiraffeApp").factory("Helper",function(){function a(){}return a.castNumericalStringAsNumber=function(a){var b,c=Number(a);return b=c||0===c?c:a},a}),angular.module("skyGiraffeApp").factory("Populator",function(){function a(){}return a.populateArray=function(a,b,c){var d=[];for(var e in a){var f=new b(a[e],c);d.push(f)}return d},a.populateHash=function(a,b,c,d){var e={};for(var f in a){var g=new b(a[f],d);e[g[c]]=g}return e},a}),angular.module("skyGiraffeApp").factory("Server",["$rootScope","$http","uuid4","SGConfig",function(a,b,c,d){function e(){}return e.request=function(e,f){var g={ApplicationID:a.appId,ReportID:a.reportId,TabID:a.tabId,DataItemUpdateIDs:[],ReportUpdateID:c.generate(),RequestID:c.generate()};for(var h in f)g[h]=f[h];var i=b({url:e,data:g,method:"POST"});return i.then(function(a){d.log(a.data)}),i},e}]),angular.module("skyGiraffeApp").filter("type",["dateFilter","DecimalFormat","$sce",function(a,b,c){var d=function(c,d,e){if(""==c||"undefined"==typeof d)return c;if("Date"==d.type){var g=new Date(c);return a(g,d.string)}var h="Currency"==d.type?d.currency:"",i="Percentage"==d.type?"%":"";if("undefined"!=typeof d.string&&null!=d.string){var j=new b(h+d.string+i);return"Gauge"==e||"Grid"==e||"SimpleGrid"==e?f(j.format(c)).replace(/^0+/,"").replace(/^\./,"0."):j.format(c).replace(/^0+/,"").replace(/^\./,"0.")}if("Percentage"==d.type){if(null==d.string){d.string="#,###";var j=new b(h+d.string+i);return"Gauge"==e?f(j.format(c)).replace(/^0+/,"").replace(/^\./,"0."):j.format(c).replace(/^0+/,"").replace(/^\./,"0.")}return 100*c+i}return h+c},e=function(a){var b=a;if(b.replace(/\./g,"").length>3){var c=b.replace(/\./g,"").length-3;b=b.slice(0,-c),c>1&&(b=b.replace(/\./g,""))}return b},f=function(a){var b=a.replace(/[,`' ]/g,""),c=b.split(/[0-9.]+/g),d=b.match(/[0-9.]+/g);return isNaN(Number(d))||(parseInt(Number(d))>=1e9?(b=(parseFloat(Number(d))/1e9).toFixed(2),b=e(b),b+="B"):parseInt(Number(d))>=1e6?(b=(parseFloat(Number(d))/1e6).toFixed(2),b=e(b),b+="M"):parseInt(Number(d))>=1e3?(b=(parseFloat(Number(d))/1e3).toFixed(2),b=e(b),b+="K"):parseInt(Number(d))>=100?(b=(parseFloat(Number(d))/1e3).toFixed(2),b=e(b)):b=parseFloat(Number(d)).toFixed(2)),b=c[0]+b+c[1]},g=function(a){return"<a href='tel:"+a.replace(/\s+/g,"")+"'>"+a+"</a>"},h=function(a){return"<a href='mailto:"+a+"' tooltip='"+a+"' tooltip-placement='right' class='email-link-as-icon'><span class='glyphicon glyphicon-envelope'></span></a><a href='mailto:"+a+"' tooltip='"+a+"' tooltip-placement='right' class='email-link-as-text'>"+a+"</a>"},i=function(a){return"<a href='http://maps.google.com/?q="+a+"' target='blank'>"+a+"</a>"},j=function(a){return"<a href='"+a+"' target='blank' class='type-link' tooltip='"+a+"' tooltip-placement='right'><span class='link-text'>"+a+"</span></a>"},k=function(a){var b;switch(a){case"-1":b="sprite-KPI01";break;case"0":b="sprite-KPI02";break;case"1":b="sprite-KPI03";break;default:return a}return"<i class='sprite "+b+"'>"},l=function(a){return"<img src='"+a+"' class='type-image'>"},m=function(a){return"<div class='icons-collection "+a+"'></div>"},n=function(a){return String.fromCharCode(parseInt(a,16))};return function(a,b,e){var f;switch(b){case"Text":f=d(a,e);break;case"Icon":f=m(a);break;case"Image":f=l(a);break;case"Phone":f=g(a);break;case"Email":f=h(a);break;case"Address":f=i(a);break;case"URL":f=j(a);break;case"KPI":f=k(a);break;case"SparkChart":f="";break;case"Gauge":f=d(a,e,b);break;case"NewsIcon":f=n(a);break;default:f=a}return c.trustAsHtml(f)}}]),angular.module("skyGiraffeApp").factory("Icon",function(){function a(a){var b=a.BackgroundColor,c=a.FontColor;b=this.standardizeHex(b),c=this.standardizeHex(c),this.backgroundColor=c,this.fontColor=b,this.fontName=a.FontName,this.shape=a.Shape,this.value=a.Value}return a.prototype.standardizeHex=function(a){return 7==a.length?a:"#"+a.substring(3,9)},a}),angular.module("skyGiraffeApp").directive("icon",function(){return{template:'<span class="sg-icon"></span>',restrict:"E",replace:!0,scope:{icon:"="},link:function(a,b,c){a.$watch("icon",function(){"undefined"!=typeof a.icon&&($(b).css("color",a.icon.fontColor),$(b).html("&#x"+a.icon.value+";"),"GLYPHICONS"==a.icon.fontName&&$(b).addClass("glyphicons"))})}}}),angular.module("skyGiraffeApp").directive("alertMessage",function(){return{template:'<div ng-show="show" role="alert">{{message}}</div>',replace:!0,restrict:"E",link:function(a,b,c){a.show=!1,a.$on("alert",function(c,d){var e="error"==d.type?"danger":d.type;b.attr("class","alert alert-"+e+" animate animated fadeInDown"),_.isUndefined(d["float"])||"floating"==d["float"]&&b.addClass("floating-msg"),b.one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){b.removeClass("animated fadeInDown")}),a.message=d.message,a.show=!0,a.currentTimeout&&clearTimeout(a.currentTimeout),a.currentTimeout=setTimeout(function(){this.$apply(function(){b.addClass("animated fadeOutUp"),b.one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){b.removeClass("animated fadeOutUp")}.bind(a)),this.show=!1}.bind(a))}.bind(a),5e3)})}}}),angular.module("skyGiraffeApp").directive("loader",function(){return{template:'<div class="main-loader"></div>',restrict:"E",replace:!0,scope:{},link:function(a,b,c){a.$on("loading-start",function(){return b.show()}),a.$on("loading-end",function(){return b.hide()})}}}),angular.module("skyGiraffeApp").factory("User",["$http","$window","SGConfig","$q","$location",function(a,b,c,d,e){function f(){}return f.login=function(e){this.logout();var f=d.defer();a({url:c.urls.auth,data:e,method:"POST"}).success(function(a,d,e,g){c.validateStatus(a.Status).isValid?(b.sessionStorage.token=a.SessionID,f.resolve()):f.reject()}).error(function(){f.reject()});return f.promise},f.logout=function(){delete b.sessionStorage.token},f.isLoggedIn=function(){return"string"==typeof b.sessionStorage.token},f.requestPassword=function(b,e){var f=d.defer();a({url:c.urls.restorePassword,data:b,method:"POST"}).success(function(a,b,c,d){a.Status>0&&(e(!0),$("#send-form").removeClass("animated flipOutY flipInY"),$("#send-form").addClass("animated flipOutY"),$("#send-form").one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$("#reset-form").removeClass("hide"),$("#send-form").addClass("hide"),$("#reset-form").addClass("animated flipInY"),$("#reset-form").one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$("#send-form").removeClass("animated flipOutY flipInY"),$("#reset-form").removeClass("animated flipInY flipOutY")})}))}).error(function(){f.reject(),e(!1)});return f.promise},f.resentRequest=function(b,e){var f=d.defer();a({url:c.urls.restorePassword,data:b,method:"POST"}).success(function(a,b,c,d){e(!0)}).error(function(){f.reject(),e(!1)});return f.promise},f.resetPassword=function(b){var f=d.defer();a({url:c.urls.resetPassword,data:b,method:"POST"}).success(function(a,b,c,d){1==a.Status&&(alert("The password has been reset successfully!","info"),e.path("/login"))}).error(function(){f.reject()});return f.promise},f}]),angular.module("skyGiraffeApp").controller("NewSessionCtrl",["$scope","$location","User","App","SGConfig","$localStorage",function(a,b,c,d,e,f){function g(){d.fetch()["finally"](function(){b.path("/apps/"+d.findDefault().id+"/reports")})}return a.version=e.version,a.navigateTo=function(a){b.path(a)},a.user={OS:"WebApp",Version:a.version},c.isLoggedIn()?void g():(a.login=function(b){"undefined"==typeof b&&(b=a.user),a.signingIn=!0,c.login(b).then(function(){g()},function(){a.signingIn=!1})},a.loginToSampleAccount=function(){var b,c=e.getEnvironment();"production"==c?b={UserName:PRODUCTION_SAMPLE_USERNAME,Password:PRODUCTION_SAMPLE_PASSWORD,OS:"WebApp",Version:a.version}:"development"==c&&(b={UserName:"yev.goldin@skygiraffe.com",Password:"Yev12345",OS:"WebApp",Version:a.version}),a.login(b)},a.serverSettings={enableControls:!1,showPopover:!1,url:e.getBaseUrl()},void(a.setBaseUrl=function(){a.serverSettings.showPopover=!1,""==a.serverSettings.url?(e.setBaseUrl(null),a.serverSettings.url=e.getBaseUrl()):e.setBaseUrl(a.serverSettings.url)}))}]).controller("DestroySessionCtrl",["$scope","$location","User","App",function(a,b,c,d){c.logout(),d.reset(),b.path("/login")}]),angular.module("skyGiraffeApp").controller("CredentialsRestoreCtrl",["$scope","$location","User","App","SGConfig","$localStorage",function(a,b,c,d,e,f){function g(){d.fetch()["finally"](function(){b.path("/apps/"+d.findDefault().id+"/reports")})}return a.version=e.version,a.isMailSent=!1,a.mailSentStatus=function(b){a.isMailSent=b,b&&e.alert("The Confirmation Code has been sent to your email.","success","floating")},a.user={OS:"WebApp",Version:a.version},a.editMailInput=function(){a.isMailSent=!1,$("#reset-form").removeClass("animated flipOutY flipInY"),$("#reset-form").addClass("animated flipOutY"),$("#reset-form").one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$("#send-form").addClass("animated flipInY"),$("#send-form").removeClass("hide"),$("#reset-form").addClass("hide"),$("#send-form").one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$("#send-form").removeClass("animated flipOutY flipInY"),$("#reset-form").removeClass("animated flipInY flipOutY")})})},a.forgotPassword=function(b){var d={LoginName:b.email};if(!_.isUndefined(b.email)&&!_.isNull(b.email)){var f=b.email.match(/[\w.-]+@[\w-]+\.[\w]+/gi);_.isUndefined(f)||_.isNull(f)?e.alert("Invalid email!","warning","floating"):b.email.length==f[0].length&&c.requestPassword(d,a.mailSentStatus)}},a.resentRequest=function(b){var d={LoginName:b.email};if(!_.isUndefined(b.email)&&!_.isNull(b.email)){var f=b.email.match(/[\w.-]+@[\w-]+\.[\w]+/gi);_.isUndefined(f)||_.isNull(f)?e.alert("Invalid email!","warning","floating"):b.email.length==f[0].length&&c.resentRequest(d,a.mailSentStatus)}},a.resetPassword=function(b){if(_.isNull(b.newPassword)||_.isNull(b.confirmPassword)||_.isNull(b.confirmationCode))e.alert("Please fill the form.","warning","floating");else if(b.newPassword==b.confirmPassword){var d={LoginName:b.email,Key:b.confirmationCode,NewPassword:b.newPassword};c.resetPassword(d,a.mailSentStatus)}else e.alert('Please make sure the "New Password" and "Confirm Password" fields are matching.',"warning","floating")},c.isLoggedIn()?void g():(a.serverSettings={enableControls:!1,showPopover:!1,url:e.getBaseUrl()},void(a.setBaseUrl=function(){a.serverSettings.showPopover=!1,""==a.serverSettings.url?(e.setBaseUrl(null),a.serverSettings.url=e.getBaseUrl()):e.setBaseUrl(a.serverSettings.url)}))}]),angular.module("skyGiraffeApp").factory("App",["$http","$q","SGConfig","Folder","Populator","Icon",function(a,b,c,d,e,f){function g(a){this.description=a.ApplicationDescription,this.id=a.ApplicationID,this.name=a.ApplicationName,this.isDefault=a.IsDefault,this.folders=e.populateArray(a.Folders,d,a.ApplicationID),this.icon=new f(a.ApplicationIcon)}return g.records={},g.reset=function(){g.records={}},g.add=function(a){var b={};for(var c in a){var d=new g(a[c]);this.records[d.id]=d,b[d.id]=d}return b},g.find=function(a){return this.records[a]},g.findDefault=function(){for(var a in this.records)if(1==this.records[a].isDefault)return this.records[a]},g.fetch=function(){var d=b.defer();return Object.keys(g.records).length>0?(d.resolve(),d.promise):(a({url:c.urls.apps,data:{},method:"POST"}).success(function(a,b,c,e){g.add(a.Applications),d.resolve()}),d.promise)},g}]),angular.module("skyGiraffeApp").factory("DataItem",["Row","Column","Populator",function(a,b,c){function d(d){this.id=d.DataItemID,this.name=d.DataItemName,this.columnCount=d.NumOfColumns,this.type=d.StructureType,this.version=d.UpdateID,this.rows=c.populateHash(d.Rows,a,"id"),this.columns=c.populateHash(d.Columns,b,"id")}return d.records={},d.add=function(a){for(var b in a)d.addRecord(a[b])},d.addRecord=function(a){var b=new d(a);return d.records[b.id]=b,b},d.find=function(a){return d.records[a]},d.prototype.findColumnIdByName=function(a){for(var b in this.columns){var c=this.columns[b];if(c.name==a)return c}},d.prototype.selectByColumnId=function(a,b){var c={};for(var d in this.rows){var e=this.rows[d];e.data[a]==b&&(c[e.id]=e)}return c},d.prototype.selectByColumn=function(a,b){var c=this.findColumnIdByName(a).id;return this.selectByColumnId(c,b)},d.prototype.getRow=function(a){return this.rows[a]},d.prototype.getColumn=function(a){return this.columns[a]},d}]),angular.module("skyGiraffeApp").factory("Row",function(){function a(a){this.id=a.ID,delete a.ID,this.data=a}return a.prototype.setDisplayOrder=function(a){this.valueForOrdering=this.data[a]},a.prototype.setDisplayOrderByRowId=function(a){this.valueForOrdering=a},a}),angular.module("skyGiraffeApp").factory("Column",function(){function a(a){this.id=a.DataItemColumnID,this.name=a.DataItemColumnName,this.type=a.DataType,this.widestValue=a.ColumnWidestValue,this.isPrimaryKey=a.IsPrimaryKey}return a}),angular.module("skyGiraffeApp").factory("Report",["$http","$window","$q","Tab","Populator","DataItem","Slicer","Parameter","SGConfig","Server","Icon",function(a,b,c,d,e,f,g,h,i,j,k){function l(a,b){this.id=a.ReportID,this.appId=b,this.name=a.ReportName,this.type=a.ReportType,this.icon=new k(a.ReportIcon),this.order=a.ReportOrdinal,this.isHidden=a.IsHidden,this.tabs=[],this.description=a.ReportDescription,this.version,this.parameters,this.slicers,this.atLeastOneParameterIsMandatory=a.AtLeastOneParameterIsMandatory}return l.records={},l.add=function(a,b){var c={};for(var d in a){var e=new l(a[d],b);c[e.id]=e,this.records[e.id]=e}return c},l.find=function(a){return this.records[a]},l.prototype.fetch=function(){var a=this,b=j.request(this.reportURL(),{});return b.success(function(b,c,d,e){i.validateStatus(b.Status).isValid&&(a.isRegular()?a.setAdditionalReportData(b):a.isParameterized()&&a.getParameterized(b))}),b},l.fetchDashboardLayout=function(b,c){var d={ReportID:b.$parent.$parent.$parent.$parent.report.id,TabID:b.options.tab.id,ApplicationID:b.$parent.$parent.$parent.$parent.app.id,SessionID:window.sessionStorage.token,RequestID:"a6952bb1-19a4-47c5-9335-e29b26cbb42e"};a.post(b.options.tab,d).then(c)},l.prototype.fetchParameterized=function(a){var b=this,c=this.parameters,d=[];for(var e in c){var f=c[e],g=a[e];g=this.formatParameterNewValue(f,g);var f=c[e],h={ParameterID:f.id,ParameterLabel:f.name,ValueID:g,ValueLabel:g};d.push(h)}var k={Parameters:d},l=j.request(i.urls.parameterizedReport,k);return l.success(function(a,c,d,e){i.validateStatus(a.Status).isValid&&b.setAdditionalReportData(a)}),l},l.prototype.updateField=function(a,b,c,d){var e=this.tabs[a],f=e.columns[b],g=f.action,h=f.getActionParameter(),i=[this.constructParameterDataForUpdate(h,d)],j=this.formatRowForTransport(e,c),k=this.constructDataForUpdate(g.id,i,j),l=this.sendUpdateRequestAndCheckStatus(k);return l},l.prototype.executeAction=function(a,b,c,d){var e=this.tabs[a],f=e.actions[b],g="undefined"==typeof d?[]:this.formatRowForTransport(e,d),h=[];for(var i in f.parameters){var j=c[i],k=f.parameters[i],l=this.constructParameterDataForUpdate(k,j);h.push(l)}var m=this.constructDataForUpdate(b,h,g),n=this.sendUpdateRequestAndCheckStatus(m);return n},l.prototype.constructParameterDataForUpdate=function(a,b){b=this.formatParameterNewValue(a,b);var c={ParameterID:a.id,SelectedValue:b};return c},l.prototype.formatParameterNewValue=function(a,b){if("undefined"==typeof b)b="";else if(a.isDate()){var c=new Date(b);b=moment(c).format("MMM-DD-YYYY [00:00:00]"),b=b.replace(/\-\-/g,"-")}else if(a.isTable()){var d=[],e="";for(var f in b){var g=1,h=a.tableParameterData;for(var i in h)d[h[i].order]=b[f][i],g++;for(var j="{",i=1;g>i;i++)1!=i&&(j+=","),j+='"'+d[i]+'"';j+="}",f>0&&(e+=","),e+=j}b=e}return b},l.prototype.constructDataForUpdate=function(a,b,c){var d={WB_Data:{Rows:[{Data:c}],Action:{ActionID:a,parameters:b}}};return d},l.prototype.sendUpdateRequestAndCheckStatus=function(a){var b=c.defer(),d=this;return d.sendUpdateRequest(a).then(function(a){d.checkUpdateStatus(a).then(function(){b.resolve()},function(a){b.reject(a)})},function(a){b.reject(a)}),b.promise},l.prototype.sendUpdateRequest=function(a){var b=c.defer(),d=j.request(i.urls.updateData,a);return d.success(function(a,c,d,e){if("undefined"!=typeof a.Result){var f=a.Result;b.resolve(f)}else b.reject(a.Msg)}),b.promise},l.prototype.checkUpdateStatus=function(a){var b=c.defer(),d=0,e=setInterval(function(){d+=1,j.request(i.urls.updateDataStatus,{WB_ID:a}).success(function(a,c,d,f){if(i.validateStatus(a.Status).isValid){var g=i.pollStatuses[a.Result];"success"==g?(clearInterval(e),b.resolve()):"failure"==g&&(clearInterval(e),b.reject(a.Msg))}}),d>20&&clearInterval(e)},3e3);return b.promise},l.prototype.formatRowForTransport=function(a,b){var c=a.getDataItem(),d=c.rows[b].data,e=[];for(var f in c.columns)e.push({Name:c.columns[f].name,Value:d[c.columns[f].id]});return e},l.prototype.setAdditionalReportData=function(a){if(this.version=a.ReportMetaData.ReportUpdateID,"undefined"!=typeof a.Data){if(null!=a.Data&&(f.add(a.Data.Data),null!=a.Data.SlicerMembers)){a.Data.SlicerMembers;this.slicers=g.add(a.Data.SlicerMembers,a.ReportMetaData.ReportSharedSlicers)}this.tabs=d.add(a.ReportMetaData.Tabs)}},l.prototype.getParameterized=function(a){"undefined"!=typeof a.Data&&null!=a.Data&&f.add(a.Data.Data),this.parameters=h.add(a.Parameters)},l.prototype.reportURL=function(){return this.isRegular()?i.urls.regularReport:i.urls.parametersForReport},l.prototype.isRegular=function(){return"SharedSlicers"==this.type},l.prototype.isParameterized=function(){return this.type="Parameterized"},l}]),angular.module("skyGiraffeApp").controller("ReportsCtrl",["$scope","$routeParams","$rootScope","App","$location",function(a,b,c,d,e){d.fetch()["finally"](function(){a.app=d.find(b.app_id),a.folders=a.app.folders,c.appId=a.app.id}),a.navigateToReport=function(b){var c="apps/"+a.app.id+"/reports/"+b;e.path(c)},a.areAllChildrenHidden=function(a){var b=!0;for(var c in a.reports)a.reports[c].isHidden||(b=!1);return b}}]).controller("ShowReportCtrl",["$scope","$routeParams","$rootScope","$location","App","Report","SGConfig","$timeout","$window","actionService","parameterService","slicerService",function(a,b,c,d,e,f,g,h,i,j,k,l){e.fetch()["finally"](function(){a.app=e.find(b.app_id),a.report=a.setReport(f.find(b.report_id)),c.appId=a.app.id,c.reportId=a.report.id,c.tabId=null,a.report.fetch()["finally"](function(){if(l.reset(),l.setFromUrl(),a.report.isRegular())a.initializeReport();else if(a.report.isParameterized()){var b=null;if(d.search().parameters){var c=d.search().parameters;b=JSON.parse(decodeURIComponent(c))}a.showParameterizedModal(b)}})}),a.setReport=function(b){return void 0==b||_.isEmpty(b)||a.$emit("reportHasBeenSet",b),b},a.checkIfHasSlicers=function(a){return a},a.$on("reportHasBeenSet",function(a,b){}),a.initializeReport=function(){a.tabs=a.report.tabs;var c=b.tab_id?b.tab_id:Object.keys(a.tabs)[0];a.setTab(c)},a.updateField=function(b,c,d,e){a.report.updateField(a.tab.id,b,c,d).then(function(){g.alert("Field updated successfully.","success")},function(a){g.alert("Error updating value: "+a,"error")})["finally"](e)},a.executeAction=function(b,c){var d=a.tab.actions[b],e=a.tab.dataItemId;d.fetch().then(function(){j.open(a.report,a.tab,d,c,e).then(function(){g.alert("Action completed successfully.","success")},function(a){g.alert("Error executing action: "+a,"error")})})},a.showSlicerModal=function(){l.open(a.report,a.tab)},a.showParameterizedModal=function(b){k.open(a.report,b).then(function(){a.initializeReport()},function(){setTimeout(function(){i.history.back()},0)})},a.setTab=function(b){a.tab=null,l.resetTabSlicerChoices(),h(function(){if(_.isUndefined(a.tabs[b]))for(var d in a.tabs){a.tab=a.tabs[d];break}else a.tab=a.tabs[b];c.tabId=a.tab.id,a.tabOptions=a.generateTabOptions(a.tab)})},a.navigateToTab=function(b,c,e,f){var g="apps/"+a.app.id+"/reports/"+b+"/tabs/"+c;"object"==typeof e&&0!=Object.keys(e).length?(e=encodeURIComponent(JSON.stringify(e)),d.path(g).search({slicers:e})):"object"==typeof f&&0!=Object.keys(f).length?(f=encodeURIComponent(JSON.stringify(f)),d.path(g).search({parameters:f})):d.path(g)},a.generateTabOptions=function(b){var c={tab:a.tab,navigateToTab:a.navigateToTab};return b.isDisplayedAsGrid()||b.isList()?(c.updateField=a.updateField,c.executeAction=a.executeAction):(a.tab.isChart()||a.tab.isPieChart()||a.tab.isDisplayedAsGrid())&&(c.slicers=l.getReportSlicerChoices()),c}}]),angular.module("skyGiraffeApp").factory("Folder",["Report",function(a){function b(b,c){this.name=b.FolderName,this.order=b.FolderOrdinal,this.reports=a.add(b.Reports,c)}return b}]),angular.module("skyGiraffeApp").factory("Tab",["Populator","DisplayColumn","DataItem","Action","SGConfig","Map","CoverFlow","ActionCollection","Chart","Navigation","Dashboard","EmployeeDirectory","URLTemplate","DetailedMap","News","List","Cards",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){function r(a,c){this.id=a.Template.ID,this.reportId=c,this.title=a.TabTitle,this.type=a.Template.Type,this.order=a.TabOrdinal,this.dataItemId=a.Template.DataItemID,this.loadModules(a),
this.addActions(a),this.columns=b.add(this.getGridColumns(a)),this.data=[],this.rows=this.getRows(this.isDetailedMap()?a.Template.Grid.DataItemID:a.Template.DataItemID),this.isChart()||this.isPieChart()||this.generateUniqueMembersForDisplayColumns(),this.navigation=this.addNavigation(a.Template.Navigation),e.log(a)}return r.records={},r.add=function(a,b){var c={};for(var d in a){var e=new r(a[d],b);c[e.id]=e,this.records[e.id]=e}return c},r.addDashboardLayout=function(a){this.dashboardLayouts=a},r.find=function(a){return this.records[a]},r.prototype.getDataItem=function(){return c.find(this.dataItemId)},r.prototype.getDisplayColumnIdByDataItemColumnId=function(a){for(var b in this.columns)if(this.columns[b].dataItemColumnId==a)return this.columns[b].id},r.prototype.getRows=function(a){return"undefined"!=typeof a&&null!=a?c.find(a).rows:void 0},r.prototype.getColumnWidestValue=function(a){var b=this.getDataItem().getColumn(a);return null!=b?b.widestValue:void 0},r.prototype.getData=function(){if(!_.isEmpty(this.data))return this.data;for(var a in this.rows){var b={};for(var c in this.columns){var d=this.columns[c],e=this.rows[a].data[d.dataItemColumnId];b[d.id]=e}b.id=this.rows[a].id,b.number=a,this.data.push(b)}return this.data},r.prototype.generateUniqueMembersForDisplayColumns=function(){var a=this.getData(),b={};for(var c in a){var d=a[c];for(var e in this.columns){var f=d[e];(b[e]=b[e]||[]).push(f)}}for(var e in b)this.columns[e].uniqueMembers=_.chain(b[e]).uniq().sortBy(function(a){return a}).value()},r.prototype.addActions=function(a){d.addInGrid(a.Template.Actions),this.actions=d.addOutGrid(a.Template.Actions)},r.prototype.loadModules=function(a){var b;this.isMap()?b=f:this.isCoverFlow()?b=g:this.isActionCollection()?b=h:this.isChart()||this.isPieChart()?b=i:this.isDashboard()?b=k:this.isEmployeeDirectory()?b=l:this.isURLTemplate()?b=m:this.isNews()?b=o:this.isDetailedMap()?b=n:this.isList()?b=p:this.isCard()&&(b=q),b&&(angular.extend(this,b.prototype),b.prototype.constructor.call(this,a))},r.prototype.addNavigation=function(a){return null==a?null:new j(a)},r.prototype.getGridColumns=function(a){return a.Template.GridColumns},r.prototype.hasActions=function(){return Object.keys(this.actions).length>0},r.prototype.hasNavigation=function(){return!(null===this.navigation)},r.prototype.isMap=function(){return"Map"==this.type},r.prototype.isDisplayedAsGrid=function(){return"Grid"==this.type||"SimpleGrid"==this.type||"CoverFlow"==this.type},r.prototype.isCoverFlow=function(){return"CoverFlow"==this.type},r.prototype.isActionCollection=function(){return"ActionCollection"==this.type},r.prototype.isChart=function(){return"Chart"==this.type},r.prototype.checkIfThereAreSlicersInParentReport=function(a){return this.isDisplayedAsGrid()||this.isList()?!0:_.isUndefined(a.$parent.report)?!1:_.isUndefined(a.$parent.report.slicers)?!1:!_.isEmpty(a.$parent.report.slicers)},r.prototype.isPieChart=function(){return"PieChart"==this.type},r.prototype.isDashboard=function(){return"Dashboard"==this.type},r.prototype.isEmployeeDirectory=function(){return"EmployeeDirectory"==this.type},r.prototype.isURLTemplate=function(){return"URL"==this.type},r.prototype.isDetailedMap=function(){return"DetailedMap"==this.type},r.prototype.isNews=function(){return"News"==this.type},r.prototype.isList=function(){return"ListCollection"==this.type},r.prototype.isSupported=function(){return"Card"!=this.type},r.prototype.isCard=function(){return"Card"==this.type},r}]),angular.module("skyGiraffeApp").factory("DisplayColumn",["Action","DataItem","Navigation","Slicer",function(a,b,c,d){function e(b){this.id=b.ID,this.name=b.ColumnFriendlyName,this.type=b.ColumnType;b.ColumnFormat||{};this.format=this.populateFormat(b.ColumnFormat),this.action=a.find(b.ActionID),this.dataItemColumnId=b.DataItemColumnID,this.isPrimary=b.IsPrimary,this.order=b.Ordnial,this.slicerId=b.SlicerID,this.sparkLine=this.generateSparkLine(b.SparkChart),this.navigation=null==b.Navigation?null:new c(b.Navigation),this.uniqueMembers=[],this.additionalData1=b.AdditionalData1}return e.records={},e.add=function(a){var b={};for(var c in a){var d=new e(a[c]);b[d.id]=d,this.records[d.id]=d}return b},e.find=function(a){return this.records[a]},e.prototype.hasAction=function(){return"undefined"!=typeof this.action},e.prototype.getActionParameter=function(){if(this.hasAction())for(var a in this.action.parameters)return this.action.parameters[a]},e.prototype.hasNavigation=function(){return!(null===this.navigation)},e.prototype.populateFormat=function(a){return null!==a?{currency:a.CurrencySign,string:a.FormatString,type:a.FormatType}:void 0},e.prototype.getUniqueMembers=function(){return _.isEmpty(this.uniqueMembers)?void 0:this.uniqueMembers},e.prototype.generateSlicersForRow=function(a,c){var e=b.find(c).getRow(a);return d.resolve(e.data,this.navigation.mappings)},e.prototype.generateNavigationParametersMapping=function(a,c){var d=b.find(c).getRow(a),e=d.data,f=this.navigation.parameters,g={};for(var h in f){var i=f[h],j=e[i.dataItemColumnId];g[i.parameterId]=j}return g},e.prototype.generateSparkLine=function(a){var b;return b=a?{color:a.Color,dataItemColumnIds:a.DataItemColumnIDs,type:a.Type}:{}},e.prototype.resolveSparkLineData=function(a,c){var d=b.find(c).getRow(a),e=_.map(this.sparkLine.dataItemColumnIds,function(a){return d.data[a]});return e},e.prototype.isImage=function(){return"Image"==this.type},e.prototype.isEmail=function(){return"Email"==this.type},e.prototype.isURL=function(){return"URL"==this.type},e.prototype.isMiniChart=function(){return"MiniChart"==this.type},e.prototype.isGauge=function(){return"Gauge"==this.type},e.prototype.isSparkLine=function(){return"SparkChart"==this.type},e.prototype.isMiniMap=function(){return"ShowMap"==this.additionalData1},e}]),angular.module("skyGiraffeApp").factory("Grid",function(){function a(){}return a}),angular.module("skyGiraffeApp").directive("grid",["$filter","$compile","Slicer","slicerService",function(a,b,c,d){function e(a,b,c){this.tab=this.getTab(a),this.data=a.getData(),this.columns=a.columns,this.updateField=b,this.grid=null,this.dataSource=null,this.executeAction=c,this.loadingCells={}}return e.prototype.getTab=function(a){if(a.isDetailedMap()){var b=angular.copy(a);return b}return a},e.prototype.filter=a,e.prototype.buildGridOptions=function(){var a={};return this.dataSource=this.buildDataSource(),a.dataSource=this.dataSource,this.applySlicers(),a.columns=this.buildColumns(),a.sortable=!0,a.pageable=!0,a.selectable=!1,a.resizable=!0,a.editable=!0,a.save=this.save.bind(this),a.height=this.calculateHeight(),a.dataBound=function(a){this.grid=a.sender,this.displayLoadingIndicators(),this.setUpActions()}.bind(this),a},e.prototype.applySlicers=function(){var a=[],b=d.getSlicers();for(var e in b){if(/^GC/.test(e))var f=e;else var g=c.find(e),h=g.findSourceColumnForTab(this.tab.id),f=this.tab.getDisplayColumnIdByDataItemColumnId(h);var i=b[e];if("(ALL)"!=i&&("object"!=typeof i||0!=i.length)){if("object"==typeof i){var j=[];for(var k in i)j.push({field:f,operator:"eq",value:i[k]});var l={logic:"or",filters:j}}else var l={field:f,operator:"eq",value:i};a.push(l)}}this.dataSource.filter(a)},e.prototype.setUpActions=function(){var a=$(this.grid.element),b=this;a.find("tr").hover(function(){var a=$(this).data("uid");b.toggleClassForRow(a,"hover",!0)},function(){var a=$(this).data("uid");b.toggleClassForRow(a,"hover",!1)}),this.tab.hasActions()&&(this.grid.element.addClass("has-actions"),a.find(".k-grid-content-locked > table > tbody > tr").on("click",function(){$(this).hasClass("hover")&&(b.buildActionMenu(this),$("#context-menu").data("kendoActionsMenu").open())}))},e.prototype.resizeLockedColumns=function(){var a=this.grid.element;a.find(".k-grid-content-locked").height(a.find(".k-grid-content").height()),a.find(".k-grid-content tr").each(function(){var b=$(this).attr("data-uid"),c=$(this).height();a.find(".k-grid-content-locked tr[data-uid='"+b+"']").height(c)})},e.prototype.calculateHeight=function(){return $(window).height()-190},e.prototype.displayLoadingIndicators=function(){angular.forEach(this.loadingCells,function(a){this.toggleLoadingForCell(a.rowUid,a.cellIndex,!0)}.bind(this))},e.prototype.toggleLoadingForCell=function(a,b,c){var d=$("tr[data-uid='"+a+"']"),e=$(d.find("td").get(b));kendo.ui.progress(e,c)},e.prototype.toggleClassForRow=function(a,b,c){var d=this.grid.element.find("tr[data-uid='"+a+"']");c?d.addClass(b):d.removeClass(b)},e.prototype.buildDataSource=function(){var a=new kendo.data.DataSource({data:this.data,pageSize:100,autoSync:!0,schema:this.buildSchema()});return a},e.prototype.buildColumns=function(a){var b=[];b.push({field:"number",title:"&nbsp;",width:"60px",editable:!1,sortable:!1,locked:!0,template:function(a){return"<span class='number'>"+a.number+"</span><a class='action' data-id='"+a.id+"'><span class='icon icon-flag'></span></a>"}});for(var c in this.columns){var d=this.columns[c],e={};e=this.buildBasicColumnDefinition(d,e),d.hasAction()&&(e=this.buildEditableColumnDefinition(d,e)),"Actions"!=d.name&&b.push(e)}return b},e.prototype.buildActionMenu=function(a){var b=this.buildActionMenuData(),c=this;$("#context-menu").remove(),this.grid.element.after("<ul id='context-menu'>"),$("#context-menu").kendoContextMenu({name:"ActionsMenu",filter:"none",target:a,dataSource:b,open:function(a){var b=$(a.target).data("uid");c.toggleClassForRow(b,"selected",!0)},close:function(a){var b=$(a.target).data("uid");c.toggleClassForRow(b,"selected",!1)},select:c.selectAction.bind(this)})},e.prototype.buildActionMenuData=function(){var a=[],b=this.tab.actions;for(var c in b){var d=b[c],e={text:"<span data-action-id='"+d.id+"'>"+d.name+"</span>",encoded:!1};a.push(e)}return a},e.prototype.selectAction=function(a){var b=$(a.item).find(".k-link span").data("action-id");if("undefined"!=typeof b){var c=$(a.target).find(".action").data("id");this.executeAction(b,c)}},e.prototype.save=function(a){var b=Object.keys(a.values)[0],c=a.model.id,d=a.values[b];d=this.translateValueToId(d),this.grid.saveChanges();var e=$(a.container).parent().data("uid"),f=$(a.container).index()+1,g=""+e+f;this.loadingCells[g]={rowUid:e,cellIndex:f};var h=function(){delete this.grid.loadingCells[g],this.grid.toggleLoadingForCell(e,f,!1)}.bind({rowUid:e,cellIndex:f,grid:this});this.updateField(b,c,d,h)},e.prototype.translateValueToId=function(a){var b=$("#dropDownEditor");if(b.length>0){var c=b.data("kendoDropDownList").dataSource.data();angular.forEach(c,function(b){return b.value==a?void(a=b.id):void 0})}return a},e.prototype.buildSchema=function(){var a={},b={};b.number={editable:!1};for(var c in this.tab.columns){var d=this.tab.columns[c];b[d.id]={validation:{required:!1},editable:"undefined"!=typeof d.action}}return a.fields=b,{model:a}},e.prototype.buildBasicColumnDefinition=function(a,b){var b={field:a.id,title:a.name,template:this.buildTemplate.bind({column:a,grid:this}),width:this.calculateColumnWidth(a),attributes:[]};return b},e.prototype.calculateColumnWidth=function(a){var b=this.tab.getColumnWidestValue(a.dataItemColumnId),c=a.name,d=5;return b=a.isURL()||a.isEmail()||a.isImage()||"undefined"==typeof b?c.length:Math.max(b.length,c.length,d),70*Math.log(b)},e.prototype.buildEditableColumnDefinition=function(a,b){return a.hasAction()&&(a.getActionParameter().isFreeText()||(b.editor=this.buildDropDownEditor.bind({tab:this.tab,actionId:a.action.id})),b.attributes["class"]="editable",b.title=b.title),b},e.prototype.buildDropDownEditor=function(a,b){var c=b.field,d=b.model[c],e=this.tab.columns[c],f=e.getActionParameter(),g=$('<input required data-bind="value:'+c+'" name="'+c+'" id="dropDownEditor" />').appendTo(a).kendoDropDownList({autoBind:!1,dataTextField:"value",dataValueField:"value",dataSource:null}).data("kendoDropDownList");if(f.hasDependencies()){var h={},i=f.getDependenciesIds(),j=b.model.id,k=this.tab.getDataItem().getRow(j);angular.forEach(i,function(a){h[a]=k.data[a]}),g.enable(!1),f.getAllowedMembersForParameterizedList(h,this.actionId).then(function(a){g.dataSource.data(a)})["finally"](function(){g.enable(!0),g.value(d),g.open()})}else{var j=b.model.id,l=f.getAllowedMembersWithoutInputDependencies(this.tab.dataItemId,j);g.dataSource.data(l)}setTimeout(function(){g.open()})},e.prototype.buildTemplate=function(a){var b=this.column,c=a[b.id],d=a.id,e=this.grid.tab.dataItemId;if(b.isSparkLine()){var a=b.sparkLine.dataItemColumnIds,f="<div></div>",g=b.resolveSparkLineData(d,e);return f=$(f).kendoSparkline({series:[{data:g,color:b.sparkLine.color}]}),$(f).get(0).outerHTML}var h=this.grid.filter("type")(c,b.type,b.format);if(b.hasNavigation()){var i=b.navigation.reportId,j=b.navigation.tabId,d=a.id,k=b.generateSlicersForRow(d,this.grid.tab.dataItemId);k=angular.toJson(k);var l={};l=b.generateNavigationParametersMapping(d,this.grid.tab.dataItemId),l=angular.toJson(l),h="<a class='navigate-to-tab' data-report-id='"+i+"' data-tab-id='"+j+"' data-slicers='"+k+"' data-report-parameters='"+l+"'>"+h+"</a>"}return h},{template:'<div id="mainGrid"></div>',replace:!0,restrict:"E",scope:{options:"="},link:function(a,b,c){var f=a.options,g=new e(f.tab,f.updateField,f.executeAction),f=g.buildGridOptions();a.$on("slicers-updated",function(){g.applySlicers(d.getSlicers())}),$("#mainGrid").kendoGrid(f);var h=a.options.navigateToTab;$("body").on("click","#mainGrid .navigate-to-tab",function(){a.$apply(function(){h($(this).data("reportId"),$(this).data("tabId"),$(this).data("slicers"),$(this).data("reportParameters"))}.bind(this))}),$(window).on("resize",function(){g&&$("#mainGrid").height(g.calculateHeight())})}}}]),angular.module("skyGiraffeApp").factory("Map",["$q","Geocoder","Navigation","Slicer",function(a,b,c,d){function e(a){this.map=this.populateMap(a.Template.Map),this.pinStyle=a.Template.Map.PinStyle}return e.prototype.populateMap=function(a){return{type:a.GPSAddressType,categoryId:a.CategoryColumnID,subjectId:a.SubjectColumnID,addressId:a.GPSAddressColumnID,phoneId:a.PhoneColumnID}},e.prototype.geocodeLatLng=function(a){var c=a.split(",",2),d={lat:parseFloat(c[0]),lng:parseFloat(c[1])};b.geocode({location:d},function(a,b){if(b===google.maps.GeocoderStatus.OK)if(a[1]){map.setZoom(11);var c=new google.maps.Marker({position:d,map:map});infowindow.setContent(a[1].formatted_address),infowindow.open(map,c)}else window.alert("No results found");else window.alert("Geocoder failed due to: "+b)})},e.prototype.generateMapMarkers=function(c){var d=_.isUndefined(c)||_.isEmpty(c)?this.getDataItem().rows:c,e=[],f=[],g=this.map,h=this;angular.forEach(d,function(a){var c=h.pinStyle.ColorSource.substr(1),d={id:a.id,coords:{latitude:0,longitude:0},options:{icon:"http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld=%E2%80%A2|"+c}};d.category=a.data[g.categoryId],d.subject=a.data[g.subjectId],d.address=a.data[g.addressId],d.phone=a.data[g.phoneId];b.geocodeAddress(d.address).then(function(a){this.latitude=a.lat,this.longitude=a.lng,this.formattedAddress=a.formattedAddress,this.address.replace(/[-\d\.]+, [-\d\.]+/g,"").length<1&&(d.address=a.formattedAddress)}.bind(d));f.push(f),e.push(d)});var i=a.defer();return a.all(f)["finally"](function(){i.resolve(e)}),i.promise},e.prototype.generateSlicersForMarker=function(a){if(this.hasNavigation()){var b=this.rows[a];return d.resolve(b.data,this.navigation.mappings)}},e}]),angular.module("skyGiraffeApp").directive("map",["uiGmapGoogleMapApi","Slicer","slicerService",function(a,b,c){var d=function(a,b){this.tab=a,this.rowsData=null,this.data=a.getDataItem(),this.navigateToTab=b,this.dataSource=null,this.renderData=null};return d.prototype.normalizeData=function(){this.rowsData=[],_.each(this.data.rows,function(a){this.rowsData.push(a)}.bind(this))},d.prototype.buildDataSource=function(){this.normalizeData();var a=new kendo.data.DataSource({data:this.rowsData});this.dataSource=a},d.prototype.generateConfig=function(){return{center:{latitude:0,longitude:0},zoom:14}},d.prototype.generateOptions=function(){return{scrollwheel:!0}},d.prototype.triggerMapNavigation=function(a){var b=this.tab.navigation.reportId,c=this.tab.navigation.tabId,d=this.tab.generateSlicersForMarker(a);this.navigateToTab(b,c,d)},d.prototype.applySlicers=function(a){var c=[],d=null,e=null;for(var f in a){if(/^GC/.test(f))d=f;else{var g=b.find(f);e=g.findSourceColumnForTab(this.tab.id),d=this.tab.getDisplayColumnIdByDataItemColumnId(e)}var h=a[f];if("(ALL)"!=h&&("object"!=typeof h||0!=h.length)){if("object"==typeof h){var i=[];for(var j in h)i.push({field:void 0!=d?d:e,operator:"eq",value:h[j]});var k={logic:"or",filters:i}}else var k={field:void 0!=d?d:"noIdInSuchDashboard",operator:"eq",value:h};c.push(k)}}this.filterRowsDataWith(c),this.dataSource.filter(c)},d.prototype.filterRowsDataWith=function(a){if(_.isUndefined(a)||_.isEmpty(a))this.renderData=this.dataSource.data();else{var b=[];_.each(this.dataSource.data(),function(c){for(var d in a){var e=a[d].filters;for(var d in e)c.data[e[d].field]==e[d].value&&b.push(c)}}),this.renderData=b}},d.prototype.populateRenderScope=function(b){var c=this;a.then(function(a){setTimeout(function(){b.tab.generateMapMarkers(c.renderData).then(function(a){b.map.markers=a})})})},{templateUrl:"views/partials/_map.html",restrict:"E",replace:!0,scope:{options:"="},link:function(b,e,f){var g=new d(b.options.tab,b.options.navigateToTab);g.buildDataSource(),g.dataSource.fetch(function(){g.renderData=g.dataSource.view(),g.populateRenderScope(b)}),b.tab=b.options.tab,b.$on("slicers-updated",function(){var a=c.getSlicers();g.applySlicers(a),g.dataSource.fetch(function(){g.populateRenderScope(b)})}),a.then(function(a){setTimeout(function(){b.map=g.generateConfig(),b.mapOptions=g.generateOptions(),b.tab.generateMapMarkers().then(function(a){b.map.markers=a})})}),b.toggleMarkerDetails=function(a){if("undefined"!=typeof b.currentMarker&&b.currentMarker.id==a.model.id)return void delete b.currentMarker;if(b.currentMarker=a.model,b.tab.isDetailedMap()){b.tab.dataItemId;b.tab.dataItemId=b.tab.grid.dataItemId;b.tab.generateSlicersForMarker(b.currentMarker.id)}},b.triggerMapNavigation=g.triggerMapNavigation.bind(g)}}}]),angular.module("skyGiraffeApp").factory("ActionCollection",["Action",function(a){function b(){}return b.prototype.addActions=function(b){this.actions=a.add(b.Template.Actions)},b}]),angular.module("skyGiraffeApp").factory("Chart",["Helper","Navigation","Slicer","SGConfig",function(a,b,c,d){function e(a){this.chart=this.populateChart(a.Template),this.axisLegendLabelLength=15,setTimeout(function(){this.hasNavigation()&&(this.navigation.mappings[0].value=this.chart.xAxisDataItemColumnId)}.bind(this))}return e.prototype.populateChart=function(a){return{type:a.ChartType,measures:this.populateChartMeasures(a.Measures),xAxisDataItemColumnId:a.XAxisDataItemColumnID,xAxisOrderByDataItemColumnId:a.XAxisOrderByDataItemColumnID,YAxisMax:a.YAxisMax,YAxisMin:a.YAxisMin}},e.prototype.populateChartMeasures=function(a){var b=[];for(var c in a)b.push({dataItemColumnId:a[c].DataItemColumnID,color:a[c].HexaColor,name:a[c].MeasureFriendlyName,id:a[c].MeasureID,type:a[c].MeasureType.toLowerCase(),order:a[c].Ordinal});return b},e.prototype.getData=function(a){var b=[],c=this.getDataItem().columns,d=jQuery.extend({},c);for(var e in this.rows){var f=this.rows[e].data,g={xAxis:f[this.chart.xAxisDataItemColumnId]};this.chart.xAxisOrderByDataItemColumnId&&(g.xAxisOrderBy=f[c[this.chart.xAxisOrderByDataItemColumnId].id]);for(var h in this.chart.measures){var i=this.chart.measures[h];g[i.dataItemColumnId]=f[i.dataItemColumnId],delete d[i.dataItemColumnId]}delete d[this.chart.xAxisDataItemColumnId],delete d[this.chart.xAxisOrderByDataItemColumnId];for(var j in d)g[j]=f[j];b.push(g)}return b},e.prototype.getDataColumnIdByDataItemColumnId=function(a){var b;return this.getData()[0][a]?b=a:this.chart.xAxisDataItemColumnId==a?b="xAxis":this.chart.xAxisOrderByDataItemColumnId==a?b="xAxisOrderBy":d.log("Error, dataItemColumnId not found in chart data item."),b},e.prototype.groupAggregateAndSortData=function(b){return b=_.groupBy(b,"xAxis"),b=this.getAggregateData(b),b=_.sortBy(b,function(b){return a.castNumericalStringAsNumber(b.xAxisOrderBy)})},e.prototype.getAggregateData=function(a){var b={},c=_.map(this.chart.measures,function(a){return a.dataItemColumnId});for(var d in a){b[d]={};for(var e in a[d]){for(var f in c){var g=c[f];b[d][g]?b[d][g]+=Number(a[d][e][g]):b[d][g]=Number(a[d][e][g])}b[d].xAxis=a[d][e].xAxis,b[d].xAxisOrderBy=a[d][e].xAxisOrderBy,b[d].xAxisTrimmed=a[d][e].xAxis.substr(0,this.axisLegendLabelLength),b[d].xAxisWithNewLines=a[d][e].xAxis.replace(/ /g,"\n")}}return b=_.map(b,function(a){return a})},e.prototype.generateSlicersForSelection=function(a){if(this.hasNavigation()){var b={};return b[this.chart.xAxisDataItemColumnId]=a,c.resolve(b,this.navigation.mappings)}},e.prototype.generateSlicers=function(a){var b=[];for(var d in a){var e=c.find(d),f=e.findSourceColumnForTab(this.id),g=this.getDataColumnIdByDataItemColumnId(f),h=a[d];if("(ALL)"!=h&&("object"!=typeof h||0!=h.length)){var i=[];if("object"==typeof h)for(var j in h)i.push({field:g,operator:"eq",value:h[j]});else i.push({field:g,operator:"eq",value:h});var k={logic:"or",filters:i};b.push(k)}}return b},e.prototype.applySlicers=function(a){var b=this.getData(),c=[];if(null!=a&&a.length>0)for(var d in a)for(var e in a[d].filters){var f=_.filter(b,function(b){return b[a[d].filters[e].field]==a[d].filters[e].value});c=c.concat(f)}else c=b;return c},e}]),angular.module("skyGiraffeApp").factory("ChartNavigation",["Action",function(a){function b(){}return b.prototype.generateNavigationMarkUp=function(a){var b=$('<div class="left" data-role="chart-data" />'),c=$("<span data-content='chart-item-info' class='navigation-link' data-report-id='"+a.reportId+"' data-tab-id='"+a.tabId+"' data-slicers='"+a.slicers+"')\"></span>");return this.tab.hasNavigation()?c.html(a.value+'<i class="glyphicon glyphicon-menu-right" aria-hidden="true"> </i>'):c.html(a.value),b.html(c),$('[data-role="chart"].k-chart').removeClass("extra-padding"),{navigationElementContainer:b,navigationElement:c}},b.prototype.generateNavigationLink=function(a){var b=a.category,c=this.tab.generateSlicersForSelection(b),d=_.isNull(this.tab.navigation)?"":this.tab.navigation.reportId,e=_.isNull(this.tab.navigation)?"":this.tab.navigation.tabId;c=angular.toJson(c),$(this.chartElement).find('.left[data-role="chart-data"]').remove();var f=this.generateNavigationMarkUp({value:b,reportId:d,tabId:e,slicers:c});if($(this.chartElement).find("#chart-measures").length>0?$(this.chartElement).find("#chart-measures").after(f.navigationElementContainer):$(this.chartElement).prepend(f.navigationElementContainer),this.tab.hasNavigation()){var g=this;f.navigationElement.on("click",function(){g.scope.$apply(function(){g.navigateToTab($(this).data("reportId"),$(this).data("tabId"),$(this).data("slicers"))}.bind(this))})}},b}]),angular.module("skyGiraffeApp").directive("barChart",["SGConfig","ChartNavigation","Slicer","slicerService",function(a,b,c,d){var e=function(a,c,d,e){this.tab=a,this.dataItem=a.getDataItem(),this.navigateToTab=c,this.chartElement=d,this.scope=e,this.axisLegendLabelLength=13,angular.extend(this,b.prototype)};return e.prototype.shortNumbersForAxis=function(a){var b="";return isNaN(Number(a))?kendo.toString(b,"##,#"):parseInt(Number(a))>=1e9?(b=(parseFloat(Number(a))/1e9).toFixed(2),b=normalizeNumberLength(b),kendo.toString(b,"##,#")+"B"):parseInt(Number(a))>=1e6?(b=(parseFloat(Number(a))/1e6).toFixed(2),b=normalizeNumberLength(b),kendo.toString(b,"##,#")+"M"):parseInt(Number(a))>=1e3?(b=(parseFloat(Number(a))/1e3).toFixed(2),b=normalizeNumberLength(b),kendo.toString(b,"##,#")+"K"):(b=parseFloat(Number(a)).toFixed(2),kendo.toString(b,"##,#"))},e.prototype.generateOptions=function(a,b){var c={},d=this.tab.applySlicers(b);return d=this.tab.groupAggregateAndSortData(d),c.title={text:"",align:"left",margin:{left:37}},c.legend=this.generateLegend(),c.seriesDefaults=this.generateSeriesDefaults(),c.series=this.generateSeries(this.tab.chart.measures),c.dataSource=this.generateDataSource(d),this.dataSource=c.dataSource,c.seriesClick=this.generateNavigationLink.bind(this),c.categoryAxis=this.generateCategoryAxis(d),c.axisDefaults={labels:{font:"14px Arial,Helvetica,sans-serif",color:"gray"},line:{color:"#eaeaea"},minorGridLines:{visible:!1}},c.valueAxis={line:{visible:!1},labels:{format:"##,#"}},_.isNull(this.tab.chart.YAxisMax)||_.isNull(this.tab.chart.YAxisMin)||(c.valueAxis.max=this.tab.chart.YAxisMax,c.valueAxis.min=this.tab.chart.YAxisMin),c},e.prototype.generateLegend=function(){return{position:"right",align:"start",offsetX:20,offsetY:-10,labels:{font:"15px Arial,Helvetica,sans-serif",margin:10}}},e.prototype.generateSeriesDefaults=function(){return{type:"column",tooltip:{visible:!0,position:"top",format:"##,#"},spacing:.5,gap:2.5,labels:{visible:!1,background:"transparent",font:"12px Arial,Helvetica,sans-serif"}}},e.prototype.generateSeries=function(b){var c=_.map(b,function(a){return{field:a.dataItemColumnId,name:a.name,color:a.color,type:a.type,overlay:{gradient:"none"},border:{width:0,color:a.color}}});for(var d in c){var e=c[d].color,f=a.colorTranslations[e];c[d].color=f?f:e}return c},e.prototype.generateCategoryAxis=function(a){var b=[];for(var c in a)a[c].filteredXAxis=a[c].xAxis.replace(/ /g,"\n"),b.push(a[c].filteredXAxis);return b=_.sortBy(b,function(a){return a.xAxisOrderBy}),{categories:b,labels:{visible:!0,rotation:0},min:2,max:5,majorTicks:{size:10,width:3},majorGridLines:{visible:!1}}},e.prototype.generateDataSource=function(a){return new kendo.data.DataSource({data:a})},e.prototype.generateSeriesInfo=function(a){var b=a.category.replace(/\n/g," ");this.currentSeriesItem.setValue(a.value),this.currentSeriesItem.setCategory(b),this.currentSeriesItem.allowNavigation(this.options.tab.hasNavigation()),$('[data-role="chart-data"] [data-content="chart-item-info"]').html(this.currentSeriesItem.text)},e.prototype.updateCurrentItem=function(a,b){return this},{templateUrl:"views/partials/_bar-chart.html",controller:"barChartCtrl",restrict:"E",replace:!0,scope:{options:"="},link:function(a,b,c){var f=new e(a.options.tab,a.options.navigateToTab,b,a),g=(a.options.tab.generateSlicers(a.options.slicers),f.generateOptions(a));f.$el=b.find("#chart-body"),b.find("#chart-body").kendoChart(g);var h=function(){var c=d.getReportSlicerChoices();g=f.generateOptions(a,a.options.tab.generateSlicers(c)),b.find("#chart-body").kendoChart(g)};h(),a.$on("slicers-updated",h),$(window).on("resize",function(){var a=b.find("#chart-body").data("kendoChart");a&&(a.options.transitions=!1,a.redraw(),a.options.transitions=!0)})}}}]).controller("barChartCtrl",["$scope","Dashboard","dashboardSrv",function(a,b,c){var d=function(){this.value="",this.category="",this.text=this.category+" - "+this.value,this.withNavigation=!1};d.prototype.allowNavigation=function(a){return _.isUndefined(a)||_.isNull(a)||(this.withNavigation=a,this.buildText()),this},d.prototype.setValue=function(a,b){return _.isUndefined(a)||_.isNull(a)||(this.value=a,this.buildText()),_.isUndefined(b)||_.isNull(b)||_.isFunction(b)||b(),this},d.prototype.setCategory=function(a,b){return _.isUndefined(a)||_.isNull(a)||(this.category=a,this.buildText()),_.isUndefined(b)||_.isNull(b)||_.isFunction(b)||b(),this},d.prototype.buildText=function(){this.withNavigation?this.text=this.category+" - "+this.value+'<i class="glyphicon glyphicon-menu-right" aria-hidden="true"> </i>':this.text=this.category+" - "+this.value},a.currentSeriesItem=new d}]),angular.module("skyGiraffeApp").directive("pieChart",["SGConfig","ChartNavigation","Slicer","slicerService",function(a,b,c,d){var e=function(a,c,d,e){this.tab=a,this.navigateToTab=c,this.chartElement=d,this.scope=e,angular.extend(this,b.prototype)};return e.prototype.generateOptions=function(b){var c={},d=this.tab.applySlicers(b);return d=this.tab.groupAggregateAndSortData(d),c.seriesColors=a.chartColors,c.theme="default",c.legend=this.generateLegend(),c.chartArea=this.generateChartArea(),c.seriesDefaults=this.generateSeriesDefaults(),c.series=this.generateSeries(),c.tooltip=this.generateTooltip(),c.dataSource=this.generateDataSource(d),c.seriesClick=this.generateNavigationLink.bind(this),c},e.prototype.generateLegend=function(){return{position:"right",align:"start",offsetX:-100,offsetY:53,visible:!0,labels:{font:"15px Arial,Helvetica,sans-serif",margin:10}}},e.prototype.generateChartArea=function(){return{background:""}},e.prototype.generateSeriesDefaults=function(){return{labels:{visible:!0,background:"transparent",template:"#= kendo.toString(percentage, 'p') # \n #= category #",position:"outsideEnd",font:"14px Arial, Helvetica, sans-serif"},holeSize:$("#chart-body").height()/3.7}},e.prototype.generateSeries=function(){var a=[{overlay:{gradient:"none"},type:"donut",field:this.getFirstMeasure().dataItemColumnId,categoryField:"xAxisTrimmed"}];return a},e.prototype.generateTooltip=function(){var a={};return a.visible=!0,a.template=function(a){return a.value},a},e.prototype.generateDataSource=function(a){return new kendo.data.DataSource({data:a})},e.prototype.getFirstMeasure=function(){return _.sortBy(this.tab.chart.measures,"order")[0]},{templateUrl:"views/partials/_pie-chart.html",restrict:"E",replace:!0,scope:{options:"="},link:function(a,b,c){var f=new e(a.options.tab,a.options.navigateToTab,b,a);a.options.tab.generateSlicers(a.options.slicers);a.builderOptions=f.generateOptions();var g=a.builderOptions;a.chart=b.find("#chart-body").kendoChart(a.builderOptions),a.measures=a.options.tab.chart.measures,a.currentMeasure=a.builderOptions.series[0].field;var h=function(){var c=d.getReportSlicerChoices();g=f.generateOptions(a.options.tab.generateSlicers(c)),$(b).find("#chart-body").kendoChart(g)};h(),a.$on("slicers-updated",h),a.changeMeasure=function(b){a.currentMeasure=b.dataItemColumnId,a.builderOptions.series[0].field=a.currentMeasure,a.chart.data("kendoChart").setOptions(a.builderOptions)},$(window).on("resize",function(){var a=b.find("#chart-body").data("kendoChart");a&&(a.options.transitions=!1,a.redraw(),a.options.transitions=!0)})}}}]),angular.module("skyGiraffeApp").factory("Dashboard",["SGConfig",function(a){function b(a){this.dashboard=this.populateDashboard(a.Template),this.gaugeRows=[],this.data=this.getData()}return b.prototype.populateDashboard=function(a){return{sectionSourceColumnId:a.SectionSourceColumnID,layoutsUpdateId:a.LayoutsUpdateID,minicharts:this.populateMinicharts(a.GridColumns),mcRows:this.populateMCRows(this.getDataItem().rows,a.GridColumns),gauges:this.populateGauges(a.GridColumns),gaugeRows:this.populateGaugeRows(this.getDataItem().rows,a.GridColumns),generateSlicers:this.generateSlicers}},b.prototype.populateMinicharts=function(a){var b=[];for(var c in a)"MiniChart"==a[c].ColumnType&&b.push({dataItemColumnId:a[c].DataItemColumnID});return b},b.prototype.populateMCRows=function(a,b){var c=[];return _.each(a,function(a,d){c.push(this.populateMinicharts(b))}.bind(this)),c},b.prototype.populateGaugeRows=function(a,b){var c=[];return _.each(a,function(a,d){c.push(this.populateGauges(b))}.bind(this)),c},b.prototype.populateGauges=function(a){var b=[];for(var c in a)"Gauge"==a[c].ColumnType&&b.push({dataItemColumnId:a[c].DataItemColumnID,gaugeObject:this.populateGaugeObject(a[c].GaugeObj)});return b},b.prototype.populateGaugeObject=function(a){return{actualValue:a.ActualValue,ColorRanges:a.ColorRanges,DisplayAsPercentage:a.DisplayAsPercentage,GaugeType:a.GaugeType,IsActualValueFromDI:a.IsActualValueFromDI,IsMaxValueFromDI:a.IsMaxValueFromDI,IsMinValueFromDI:a.IsMinValueFromDI,IsTargetValueFromDI:a.IsTargetValueFromDI,MaxValue:a.MaxValue,MinValue:a.MinValue,TargetValue:a.TargetValue}},b.prototype.buildMiniChartsBarChartsYAxisValues=function(a,b,c){for(var d=a.length,e=0;d>e;e++){for(var f=1;f<=b.length/d;f++)null!=c[e]&&"undefined"!=c[e]||(c[e]=[]),c[e].push(b[e*(b.length/d)+f-1]);c[e]=_.map(c[e],function(a){return a;
})}},b.prototype.buildMiniChartsBarChartsMeasureColors=function(b){b=b.split(",");for(var c in b){b[c]="#"+b[c];var d=a.colorTranslations[b[c]];b[c]=d?d:b[c]}return b},b.prototype.generateMiniChartsData=function(){var b=this.dashboard.minicharts,c=[];return _.each(this.dashboard.mcRows,function(d,e){var f=[];for(var g in d){var h=this.getDataItem().rows[e+1].data[d[g].dataItemColumnId];h=h.split(";");var i=h[0].replace("bvg","column").replace("p","donut"),j=h[2].split(","),k=[],l=h[1];"column"==i?(l=this.buildMiniChartsBarChartsMeasureColors(l),this.buildMiniChartsBarChartsYAxisValues(l,j,k)):"donut"==i?(l=l.split("|"),k=h[2].split(","),k=$.map(k,function(a){return a})):a.log("The chart type is not valid.");var m=h[3].split("|"),n=h[4];f.push({chartType:i,measureColors:l,yAxisValues:k,xAxisValues:m,maxYValue:n,dataItemColumnId:b[g].dataItemColumnId})}c.push(f)}.bind(this)),c},b.prototype.getGaugeMax=function(a){var b=a.gaugeObject.IsMaxValueFromDI,c=a.gaugeObject.MaxValue,d=null;return d=b?this.rows[1].data[c]:c,parseInt(d)},b.prototype.getGaugeMin=function(a){var b=a.gaugeObject.IsMinValueFromDI,c=a.gaugeObject.MinValue,d=null;return d=b?this.rows[1].data[c]:c,parseInt(d)},b.prototype.getGaugeTarget=function(a){var b=a.gaugeObject.IsTargetValueFromDI,c=a.gaugeObject.TargetValue,d=null;return d=b?this.rows[1].data[c]:c,parseInt(d)},b.prototype.generateCustomTargetPointer=function(a){if(null!=a.gaugeObject.TargetValue){var b,c,d=this.getGaugeTarget(a),e=this.getGaugeMax(a),f=180*d/e,g=2*Math.PI/360*f,h=110;g<=Math.PI/2?(b=h*Math.sin(g),c=h*Math.cos(g)):g>Math.PI/2&&g<=2*Math.PI&&(b=-1*h*Math.sin(2*Math.PI-g),c=h*Math.cos(2*Math.PI-g))}return{x:b,y:c}},b.prototype.hasGaugeTarget=function(a){var b;return b=null!=a.gaugeObject.TargetValue},b.prototype.generateSlicers=function(a){var b=[];for(var c in a){var d=Slicer.find(c),e=d.findSourceColumnForTab(this.id),f=this.getDataColumnIdByDataItemColumnId(e),g=a[c];if("(ALL)"!=g&&("object"!=typeof g||0!=g.length)){var h=[];if("object"==typeof g)for(var i in g)h.push({field:f,operator:"eq",value:g[i]});else h.push({field:f,operator:"eq",value:g});var j={logic:"or",filters:h};b.push(j)}}return b},b}]),angular.module("skyGiraffeApp").directive("dashboard",["SGConfig","Slicer","slicerService","Report","Chart",function(a,b,c,d,e){var f=function(a){this.tab=a,this.rows=a.rows,this.normalizeIds(a),this.data=a.getData(),this.dataSource=null,this.renderData=null,this.axisLegendLabelLength=5};return f.prototype.buildDataSource=function(){var a=new kendo.data.DataSource({data:this.data});return a},f.prototype.getPanelData=function(){return this.data},f.prototype.generateMiniChartPieChartOptions=function(b){return{seriesColors:a.chartColors,theme:"default",legend:{visible:!0,position:"right",labels:{font:"14px Helvetica,sans-serif",margin:4}},chartArea:{background:""},seriesDefaults:{labels:{visible:!1,background:"transparent",template:"#= category #: #= kendo.toString(percentage, 'p') #",position:"outsideEnd"},holeSize:88},series:[{type:"donut",data:[],padding:5,overlay:{gradient:"none"}}],tooltip:{visible:!0,template:function(a){return a.value},format:"##,#"}}},f.prototype.generateMiniChartBarChartOptions=function(a){return{legend:{visible:!1},seriesDefaults:{type:a.chartType,tooltip:{format:"##,#"}},series:[{padding:0}],valueAxis:{line:{visible:!1},minorGridLines:{visible:!1},labels:{visible:!0,format:"##,#"}},categoryAxis:{categories:a.xAxisValues,majorGridLines:{visible:!1},labels:{rotation:45}},tooltip:{visible:!0}}},f.prototype.generateMiniChartOptions=function(b){var c=[];return _.each(b,function(b,d){var e=[];for(var f in b)if(null!=e[f]&&"undefined"!=e||e.push([]),"column"==b[f].chartType){e[f].push(this.generateMiniChartBarChartOptions(b[f],d),b[f].dataItemColumnId);for(var g in b[f].yAxisValues)e[f][0].series.push({data:b[f].yAxisValues[g],color:b[f].measureColors[g],overlay:{gradient:"none"},border:{width:1,color:b[f].measureColors[g]}})}else if("donut"==b[f].chartType){e[f].push(this.generateMiniChartPieChartOptions(b[f],d),b[f].dataItemColumnId);for(var h in b[f].yAxisValues)e[f][0].series[0].data.push({category:b[f].xAxisValues[h].substr(0,this.axisLegendLabelLength),value:b[f].yAxisValues[h],overlay:{gradient:"none"}})}else a.log("Chart type not valid.");c.push(e)}.bind(this)),c},f.prototype.generateGaugesOptions=function(b){var c=[];return _.each(b,function(b,d){var e=[];for(var f in b)null!=e[f]&&"undefined"!=e||e.push([]),"Full"==b[f].gaugeObject.GaugeType||"Half"==b[f].gaugeObject.GaugeType||"Solid"==b[f].gaugeObject.GaugeType?e[f].push(this.generateGaugeOptions(b[f],d),b[f].dataItemColumnId):a.log("Gauge type not supported.");c.push(e)}.bind(this)),c},f.prototype.generateGaugeOptions=function(a,b){var c=this.renderData[b][this.tab.getDisplayColumnIdByDataItemColumnId(a.dataItemColumnId)],d=a.gaugeObject.TargetValue;this.tab.getGaugeMax(a)==this.tab.getGaugeMin(a)&&(c=0);var e={pointer:[{value:c,cap:{color:"Full"==a.gaugeObject.GaugeType?"#FFFFFF":"#5f5f5f",size:.05},color:"Full"==a.gaugeObject.GaugeType?"#FFFFFF":"#5f5f5f",visible:"Full"!=a.gaugeObject.GaugeType}],gaugeArea:{margin:{top:0,bottom:0,left:0,right:0}},axisDefaults:{line:{color:"#eaeaea"},minorGridLines:{visible:!1}},scale:this.generateGaugeScale(a,c)};return null!=d&&e.pointer.push({value:d,cap:{color:"Full"==a.gaugeObject.GaugeType?"#FFFFFF":"#5f5f5f",size:.01},color:"Full"==a.gaugeObject.GaugeType?"#FFFFFF":"#5f5f5f",visible:"Full"!=a.gaugeObject.GaugeType}),e},f.prototype.generateGaugeColorRanges=function(b,c){var d=b.gaugeObject.ColorRanges,e=b.gaugeObject.GaugeType,f=[],g=this.tab.getGaugeMin(b);if("Half"==e)for(var h in d)f.push({from:d[h].Min,to:d[h].Max,color:d[h].Color});else if("Full"==e||"Solid"==e)for(var h in d){if(d[h].Min<=c&&c<=d[h].Max){f.push({from:g,to:c,color:d[h].Color});break}d[h].Min==d[h].Max&&f.push({from:g,to:d[h].Max,color:"#dedede"})}else a.log("Gauge type not supported");return _.isEmpty(f)&&f.push({from:g,to:parseInt(this.tab.getGaugeMax(b)),color:"#52bddd"}),f},f.prototype.generateGaugeScale=function(a,b){var c=a.gaugeObject.GaugeType,d=this.tab.getGaugeMax(a),e=this.tab.getGaugeMin(a),f=this.generateGaugeColorRanges(a,b);return d==e&&(e=-Math.abs(e),d=Math.abs(e),f.length=0,f.push({from:0,to:0,color:"#dedede"})),{majorUnit:this.calculateGaugeFullRange(a),startAngle:"Full"==c?90:0,endAngle:"Full"==c?450:180,max:d,min:e,labels:{position:"Full"==c?"inside":"outside",visible:"Full"!=c},ranges:f,majorTicks:{visible:!1},minorTicks:{visible:!1},rangeSize:"Full"==c?null:10,rangeDistance:"Full"==c?null:-5}},f.prototype.calculateGaugeFullRange=function(a){var b=this.tab.getGaugeMax(a)-this.tab.getGaugeMin(a);return b},f.prototype.applySlicers=function(){var a=[],d=c.getSlicers();this.normalizeIds(this.tab);var e=null;for(var f in d){if(/^GC/.test(f))e=f;else{var g=b.find(f),h=g.findSourceColumnForTab(this.tab.id);e=this.tab.getDisplayColumnIdByDataItemColumnId(h)}var i=d[f];if("(ALL)"!=i&&("object"!=typeof i||0!=i.length)){if("object"==typeof i){var j=[];for(var k in i)j.push({field:void 0!=e?e:"noIdInSuchDashboard",operator:"eq",value:i[k]});var l={logic:"or",filters:j}}else var l={field:void 0!=e?e:"noIdInSuchDashboard",operator:"eq",value:i};a.push(l)}}this.sliceRowsDataWith(a),this.dataSource.filter(a)},f.prototype.sliceRowsDataWith=function(a){var b=this.tab.rows,c=[],d={};d.filters=a;for(var e in a){if(void 0==d.filters[e].filters){var f={filters:[d.filters[e]]};d.filters[e]=f}var g=[];_.each(b,function(a,b){if(void 0!=d.filters[e])for(var c in d.filters[e].filters)if(void 0!=d.filters[e].filters[c].field&&void 0!=this.tab.columns[d.filters[e].filters[c].field]){var f=this.tab.columns[d.filters[e].filters[c].field].dataItemColumnId,h=a.data[f];h==d.filters[e].filters[c].value&&(g.push(a),g[g.length-1].sId=g.length)}}.bind(this)),c=g,_.isEmpty(c)||(b=c)}this.rows=c,_.isEmpty(d.filters)&&this.normalizeIds(this.tab)},f.prototype.filterWidgetData=function(a){var b=[],c=_.pluck(this.rows,"id");for(var d in c)b.push(a[c[d]-1]);return b},f.prototype.normalizeIds=function(a){this.rows=a.rows;for(var b in this.rows)this.rows[b].sId=parseInt(b)},f.prototype.populateRenderScope=function(a){var b=c.getSlicers();_.isEmpty(b)||this.applySlicers(b),a.tab=a.options.tab,a.rowsData=this.rows,a.isDashboardTileTwoLine=this.isDashboardTileTwoLine,a.navigateToTab=a.options.navigateToTab,a.panelData=this.dataSource.view();var d=this.filterWidgetData(a.tab.generateMiniChartsData()),e=this.filterWidgetData(a.tab.dashboard.gaugeRows);a.minicharts=this.generateMiniChartOptions(d),a.gauges=this.generateGaugesOptions(e)},f.prototype.sortByLayout=function(a){for(var b in a.cells)a.options.tab.columns[a.cells[b].GridColumnID].order=a.cells[b].order},f.prototype.isDashboardTileTwoLine=function(a){return void 0==a?!0:2==a.h},{templateUrl:"views/partials/_dashboard.html",restrict:"E",replace:!0,controller:"DashboardCtrl",scope:{options:"="},link:function(a,b,c){var d=new f(a.options.tab);a.populateDashboardLayouts(a.options.tab,function(){d.dataSource=d.buildDataSource(),!_.isUndefined(a.cells)&&!_.isNull(a.cells)&&a.cells.length>0&&d.sortByLayout(a),d.dataSource.fetch(function(){d.renderData=d.dataSource.view(),d.populateRenderScope(a)})}),a.$on("slicers-updated",function(){d.dataSource.fetch(function(){d.populateRenderScope(a)})}),$(window).on("resize",function(){$(".gauge").each(function(){var a=$(this).data("kendoRadialGauge");a&&a.resize()}),$(".minichart").each(function(){var a=$(this).data("kendoChart");a&&a.resize()})})}}}]),angular.module("skyGiraffeApp").service("dashboardSrv",["$http","SGConfig","$window",function(a,b,c){this.fetchDashboardLayouts=function(d,e){var f={ReportID:d.scope.$root.reportId,TabID:d.scope.$root.tabId,ApplicationID:d.scope.$root.appId,SessionID:c.sessionStorage.token,RequestID:"a6952bb1-19a4-47c5-9335-e29b26cbb42e"};a({method:"POST",url:b.urls.dashboardLayout,data:f,contentType:"application/json"}).then(e,function(){})}}]),angular.module("skyGiraffeApp").controller("DashboardCtrl",["$scope","Dashboard","dashboardSrv",function(a,b,c){a.populateDashboardLayouts=function(b,d){var e=this;e.options.tab.layouts={},c.fetchDashboardLayouts({scope:a,tap:b},function(a){_.isNull(a.data)||_.isUndefined(a.data)||(e.options.tab.layouts=a.data,"null"!=a.data&&(e.cells=e.mapLayout(a.data.Landscape)),_.isNull(d)||_.isUndefined(d)||d())})},a.mapLayout=function(a){var b=[],c=a.Width,d=a.Cells,e=_.min(_.pluck(d,"Size"),function(a){return a.Height}).Height;for(var f in d){var g={};g.w=12/c*d[f].Size.Width,g.h=d[f].Size.Height==e?1:2,g.heightClass=1==g.h?"one-line":"two-line",g.GridColumnID=d[f].GridColumnID,g.order=parseInt(f),b.push(g)}return console.log("Layout remap for WebApp:",b),b},a.newChartData={labels:["Jahnuary","February","March","April","May","June","July"],datasets:[{label:"My First dataset",fillColor:"rgba(16,0,255,1)",strokeColor:"rgba(220,220,220,0.8)",highlightFill:"rgba(220,220,220,0.75)",highlightStroke:"rgba(220,220,220,1)",data:[65,59,80,81,56,55,53]},{label:"My Second dataset",fillColor:"rgba(151,187,205,0.5)",highlightFill:"rgba(151,187,205,0.75)",highlightStroke:"rgba(151,187,205,1)",data:[28,48,40,19,86,27,90]}]},a.newChartOptions={responsive:!0,scaleBeginAtZero:!0,scaleShowGridLines:!0,scaleGridLineColor:"rgba(0,0,0,.05)",scaleGridLineWidth:1,barShowStroke:!0,barStrokeWidth:2,barValueSpacing:5,barDatasetSpacing:1,legendTemplate:'<ul class="tc-chart-js-legend"><% for (var i=0; i<datasets.length; i++){%><li><span style="background-color:<%=datasets[i].fillColor%>"></span><%if(datasets[i].label){%><%=datasets[i].label%><%}%></li><%}%></ul>'}}]),angular.module("skyGiraffeApp").directive("radialGauge",["SGConfig","$timeout",function(a,b){var c=function(a){this.item=a.item,this.gaugeIndex=a.$index};return c.prototype.applyGaugePointerCssCLass=function(a,b,c){if(c.TargetValue){var d=$($(a).find("g>g>path+circle").prev()[1]);if(d.length&&"Full"!=c.GaugeType&&(d.attr("class",b),d.attr("d").match(/([\d.]+ [\d.]+)/g).length>2)){var e=d.attr("d").replace(/( [\d.]+ [\d.]+)Z/g,"Z");d.attr("d",e)}}},c.prototype.getGaugeSettings=function(a){return a.dashboard.gauges[this.gaugeIndex].gaugeObject},{templateUrl:"views/partials/_radialgauge.html",restrict:"E",replace:!1,scope:{options:"=",gauges:"=rgData",column:"=rgColumn",tab:"=rgTab",row:"=rgRow",panelData:"=rgPanel"},link:function(a,d,e){var f=new c(a.$parent);a.item=f.item,a.parentIndex=f.gaugeIndex,a.el=d,a.applyDashedStyle=f.applyGaugePointerCssCLass,a.gaugeSettings=f.getGaugeSettings(a.tab),b(function(){$(d).find('[data-role="radial-gauge"]').kendoRadialGauge(a.item[0]),f.applyGaugePointerCssCLass(d,"dashed-pointer",a.gaugeSettings),$(window).on("resize",function(){f.applyGaugePointerCssCLass(d,"dashed-pointer",a.gaugeSettings)})},0)}}}]).directive("renderRadialGaugeOnParentLoad",["SGConfig",function(a){return{templateUrl:"views/partials/_empty.html",restrict:"E",replace:!1,link:function(a,b,c){window.RGonLoadRenderScope=a,a.item[1]==a.column.dataItemColumnId&&($(a.el).find('[data-role="radial-gauge"]').kendoRadialGauge(a.item[0]),window.lastGauge=$(a.el).data("kendoRadialGauge")),a.applyDashedStyle(a.el,"dashed-pointer",a.gaugeSettings),$(window).on("resize",function(){a.applyDashedStyle(a.el,"dashed-pointer",a.gaugeSettings)})}}}]),angular.module("skyGiraffeApp").directive("employeeDirectory",["SGConfig",function(a){var b=function(a,b){this.tab=a,this.data=a.getData(),this.currentEmployee="";var c=null!=a.employeeDirectory.employeeStructure.LastName?a.employeeDirectory.employeeStructure.LastName:a.employeeDirectory.employeeStructure.FirstName;for(var d in this.tab.rows)this.tab.rows[d].setDisplayOrder(c)};return b.prototype.getFirstEmployeeRow=function(){var a=this.tab.rows,b=a[1];for(var c in a)a[c].valueForOrdering<b.valueForOrdering?b=a[c]:null;return b},{templateUrl:"views/partials/_employeedirectory.html",restrict:"E",replace:!0,scope:{options:"="},link:function(a,c,d){var e=new b(a.options.tab,a.options.navigateToTab);a.tab=a.options.tab,a.navigateToTab=a.options.navigateToTab,a.currentEmployee=e.currentEmployee,a.setCurrEmployee=a.options.tab.setCurrEmployee;var f=e.getFirstEmployeeRow();a.setCurrEmployee(f),a.additionalDetailsData=e.data,a.isCurrentEmployeeSet=!1}}}]),angular.module("skyGiraffeApp").factory("EmployeeDirectory",function(){function a(a){this.employeeDirectory=this.populateEmployeeDirectory(a.Template)}return a.prototype.populateEmployeeDirectory=function(a){return{employeeStructure:this.populateEmployeeStructure(a.EmployeeStructure),departmentsStyle:this.populateDepartmentsStyle(a.DepartmentsStyle),defaultDepartmentColor:a.DepartmentsStyle.DefaultColor}},a.prototype.populateEmployeeStructure=function(a){return a},a.prototype.setCurrEmployee=function(a){var b=a.data,c=this.tab.employeeDirectory.employeeStructure;this.tab.employeeDirectory.currentEmployeeRowId=a.id,this.tab.employeeDirectory.currentEmployeeFirstName=b[c.FirstName],this.tab.employeeDirectory.currentEmployeeMiddleName=b[c.MiddleName],this.tab.employeeDirectory.currentEmployeeLastName=b[c.LastName],this.tab.employeeDirectory.currentEmployeeJobTitle=b[c.JobTitle],this.tab.employeeDirectory.currentEmployeeDepartment=b[c.Department],this.tab.employeeDirectory.currentEmployeeImageSource=b[c.ImageSource],this.tab.employeeDirectory.currentEmployeeImageType=c.ImageType,this.tab.employeeDirectory.currentEmployeeSocialNetworks=this.tab.setCurrentEmployeeSocialNetworks(b)},a.prototype.setCurrentEmployeeSocialNetworks=function(a){var b=[],c=this.employeeDirectory.employeeStructure.SocialNetworks;for(var d in c){var e=a[c[d].Link];b.push({Type:c[d].Type,Link:e})}return b},a.prototype.populateDepartmentsStyle=function(a){var b=[],c=a.Configurations;for(var d in c)b[c[d].Name]=c[d].HexColor;return b},a.prototype.isImageTypeURL=function(){return"URL"==this.employeeDirectory.employeeStructure.ImageType},a.prototype.isImageTypeDataItem=function(){return"DataItem"==this.employeeDirectory.employeeStructure.ImageType},a.prototype.isImageTypeAvatar=function(){return"Avatar"==this.employeeDirectory.employeeStructure.ImageType},a.prototype.isAvatarMale=function(a){return"Male"==a||"M"==a},a.prototype.isAvatarFemale=function(a){return"Female"==a||"F"==a},a.prototype.isAvatarOther=function(a){return"Female"!=a&&"F"!=a&&"Male"!=a&&"M"!=a},a.prototype.isURLEmpty=function(a){var b=!1;return b=""==a},a.prototype.getDepartmentColor=function(a){return null!=this.employeeDirectory.departmentsStyle[a]?this.employeeDirectory.departmentsStyle[a]:this.employeeDirectory.defaultDepartmentColor},a.prototype.getDepartmentVisibility=function(a){return""==a.data[this.employeeDirectory.employeeStructure.Department]||null==a.data[this.employeeDirectory.employeeStructure.Department]?"hidden":"visible"},a.prototype.convertToBase64=function(a){if(!window.btoa){var b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",c=b.split("");window.btoa=function(a){for(var b=0,d=0,e=a.length/3,f=[];e>b;++b){var g=a.charCodeAt(d++),h=a.charCodeAt(d++),i=a.charCodeAt(d++);if((g|h|i)>255)throw new Error("String contains an invalid character");f[f.length]=c[g>>2]+c[g<<4&63|h>>4]+(isNaN(h)?"=":c[h<<2&63|i>>6])+(isNaN(h+i)?"=":c[63&i])}return f.join("")}}return btoa(String.fromCharCode.apply(null,a.replace(/\r|\n/g,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")))},a}),angular.module("skyGiraffeApp").factory("URLTemplate",function(){function a(a){this.data=this.getData(),this.urlTemplate=this.populateURLTemplate(a.Template),this.urlType=this.urlTemplate.urlConfig.URLType,this.urlAddress=this.getURLAddress()}return a.prototype.populateURLTemplate=function(a){return{urlConfig:a.UrlConfig}},a.prototype.isURLTypeDataItem=function(){return"DataItem"==this.urlType},a.prototype.isURLTypeConstant=function(){return"Constant"==this.urlType},a.prototype.getURLAddress=function(){var a;if(this.isURLTypeDataItem()){var b=this.getDataItem(),c=b.rows[1].data;a=c[this.urlTemplate.urlConfig.URLLinkSource]}else this.isURLTypeConstant()?a=this.urlTemplate.urlConfig.URLLinkSource:SGConfig.log("Unsupported URL type.");return a},a}),angular.module("skyGiraffeApp").directive("urlTemplate",function(){var a=function(a){this.tab=a,this.data=a.getData()};return{templateUrl:"views/partials/_urltemplate.html",restrict:"E",replace:!0,scope:{options:"="},link:function(b,c,d){new a(b.options.tab);b.tab=b.options.tab}}}),angular.module("skyGiraffeApp").factory("DetailedMap",["$q","Geocoder","Navigation","Slicer","Map",function(a,b,c,d,e){function f(a){var b=new e(a);this.map=b.map,this.grid={dataItemId:a.Template.Grid.DataItemID};var c;c=e,angular.extend(this,c.prototype),this.additionalInfoMapping=a.Template.AdditionalInfoMapping}return f.prototype.getGridColumns=function(a){return a.Template.Grid.GridColumns},f}]),angular.module("skyGiraffeApp").directive("news",["SGConfig",function(a){var b=function(a){this.tab=a,this.data=a.getData();for(var b in this.tab.rows)this.tab.rows[b].setDisplayOrder(a.news.newsStructure.date)};return{templateUrl:"views/partials/_news.html",restrict:"E",replace:!0,scope:{options:"="},link:function(a,c,d){new b(a.options.tab);a.tab=a.options.tab}}}]),angular.module("skyGiraffeApp").factory("News",function(){function a(a){this.news=this.populateNews(a.Template)}return a.prototype.populateNews=function(a){return{newsStructure:this.populateNewsStructure(a.NewsStructure),iconStyle:this.populateIconStyle(a.NewsIconStyle),defaultIcon:a.NewsIconStyle.DefaultIconUnicode}},a.prototype.populateNewsStructure=function(a){return{category:a.Category,date:a.Date,description:a.Description,title:a.Title,url:a.URL,urlTitle:a.UrlTitle}},a.prototype.populateIconStyle=function(a){var b={},c=a.Style;for(var d in c)b[c[d].CategoryName]=c[d].IconUnicode;return b},a.prototype.hasIcon=function(a){return null==this.news.newsStructure.category||null==a.data[this.news.newsStructure.category]?!1:null!=this.news.iconStyle[a.data[this.news.newsStructure.category]]},a}),angular.module("skyGiraffeApp").directive("list",["SGConfig","actionService","$window","Slicer","slicerService",function(a,b,c,d,e){var f=function(a,b,d,e){this.tab=a,this.normalizeIds(a),this.data=a.getData(),this.rows=this.tab.rows,this.dataSource=this.buildDataSource(),this.columns=a.columns,this.currentListItem="",this.executeAction=d,this.updateField=b,this.navigateToTab=e;for(var f in this.tab.rows)null!=this.tab.list.sectionSourceColumnId?this.tab.rows[f].setDisplayOrder(this.tab.list.sectionSourceColumnId):this.tab.rows[f].setDisplayOrderByRowId(this.tab.rows[f].id);if(1==Object.keys(this.tab.rows).length&&1==Object.keys(this.tab.columns).length)for(var g in this.tab.columns)"URL"==this.tab.columns[g].type&&c.open(this.tab.rows[1].data[this.tab.columns[g].dataItemColumnId])};return f.prototype.buildDataSource=function(){var a=new kendo.data.DataSource({data:this.data});return a},f.prototype.setIndexForCss=function(a,b){a.selectedIndex=b},f.prototype.normalizeIds=function(a){this.rows=a.rows;for(var b in this.rows)this.rows[b].sId=parseInt(b)},f.prototype.executeCellAction=function(a,b,c){var d=b.id,e=a.id;this.updateField(d,e,c)},f.prototype.translateValueToId=function(a,b){if(b.length>0){var c=b.data("kendoDropDownList").dataSource.data();angular.forEach(c,function(b){return b.value==a?void(a=b.id):void 0})}return a},f.prototype.applySlicers=function(a){var b=[];this.normalizeIds(this.tab);var c=null;for(var e in a){if(/^GC/.test(e))c=e;else{var f=d.find(e),g=f.findSourceColumnForTab(this.tab.id);c=this.tab.getDisplayColumnIdByDataItemColumnId(g)}var h=a[e];if("(ALL)"!=h&&("object"!=typeof h||0!=h.length)){if("object"==typeof h){var i=[];for(var j in h)i.push({field:void 0!=c?c:"noIdInSuchDashboard",operator:"eq",value:h[j]});var k={logic:"or",filters:i}}else var k={field:void 0!=c?c:"noIdInSuchDashboard",operator:"eq",value:h};b.push(k)}}this.sliceRowsDataWith(b),this.dataSource.filter(b)},f.prototype.sliceRowsDataWith=function(a){var b=this.tab.rows,c=[],d={};d.filters=a;for(var e in a){if(void 0==d.filters[e].filters){var f={filters:[d.filters[e]]};d.filters[e]=f}var g=[];_.each(b,function(a,b){if(void 0!=d.filters[e])for(var c in d.filters[e].filters)if(void 0!=d.filters[e].filters[c].field&&void 0!=this.tab.columns[d.filters[e].filters[c].field]){var f=this.tab.columns[d.filters[e].filters[c].field].dataItemColumnId,h=a.data[f];h==d.filters[e].filters[c].value&&(g.push(a),g[g.length-1].sId=g.length)}}.bind(this)),c=g,_.isEmpty(c)||(b=c)}this.rows=c,_.isEmpty(d.filters)&&this.normalizeIds(this.tab)},f.prototype.populateRenderScope=function(a){a.tab=a.options.tab,a.rows=this.rows,a.setCurrentListItem=a.options.tab.setCurrentListItem,a.isOneLayerList=a.options.tab.isOneLayerList,a.actionsCount=this.actionsCount;var b=void 0!=a.rows[0]?a.rows[0]:a.rows[1];for(var c in a.rows)a.rows[c].valueForOrdering<b.valueForOrdering&&(b=a.rows[c]);a.setCurrentListItem(b),a.executeCellAction=this.executeCellAction,a.getDropDownDataSource=this.getDropDownDataSource,a.translateValueToId=this.translateValueToId,a.getCurrentDropDownIndex=this.getCurrentDropDownIndex,a.updateField=this.updateField,a.executeAction=this.executeAction,a.navigateToTab=this.navigateToTab,a.selectedIndex=0},f.prototype.actionsCount=function(){var a=0;if(!(_.isNull(this.tab)||_.isUndefined(this.tab)||_.isNull(this.tab.actions)||_.isUndefined(this.tab.actions)))for(var b in this.tab.actions)a++;return a},{templateUrl:"views/partials/_list.html",restrict:"E",replace:!0,scope:{options:"="},link:function(a,b,c){var d=a.options,g=new f(d.tab,d.updateField,d.executeAction,d.navigateToTab);a.tab=a.options.tab,a.setCurrentListItem=a.options.tab.setCurrentListItem,a.isOneLayerList=a.options.tab.isOneLayerList;var h=a.tab.rows[1];for(var i in a.tab.rows)a.tab.rows[i].valueForOrdering<h.valueForOrdering&&(h=a.tab.rows[i]);a.setCurrentListItem(h),a.executeCellAction=g.executeCellAction,a.getDropDownDataSource=g.getDropDownDataSource,a.translateValueToId=g.translateValueToId,a.getCurrentDropDownIndex=g.getCurrentDropDownIndex,a.updateField=g.updateField,a.executeAction=g.executeAction,a.navigateToTab=g.navigateToTab,a.selectedIndex=0,g.populateRenderScope(a),a.$on("slicers-updated",function(){g.dataSource.fetch(function(){var b=e.getSlicers();g.applySlicers(b),g.populateRenderScope(a)})}),a.setIndexForCss=function(b){a.selectedIndex=b},a.submitFreeTextCellAction=function(a,b,c){if(13==c.keyCode){var d=c.currentTarget.value;this.executeCellAction(a,b,d)}},a.submitListCellAction=function(b,c,d){var e=d.sender.element.context.value,f=d.sender.element;e=a.translateValueToId(e,f),this.executeCellAction(b,c,e)},a.navigateToTabWrapper=function(b,c){if(c.hasNavigation()){var d=c.navigation.reportId,e=c.navigation.tabId,f=b.id,g=c.generateSlicersForRow(f,this.tab.dataItemId);g=angular.toJson(g),g=JSON.parse(g);var h={};h=c.generateNavigationParametersMapping(f,this.tab.dataItemId),h=angular.toJson(h),h=JSON.parse(h),a.navigateToTab(d,e,g,h)}}}}}]),angular.module("skyGiraffeApp").directive("dropDownList",["$rootScope",function(a){return{template:"<div></div>",restrict:"E",replace:!0,scope:{rowParam:"=",columnParam:"=",tabParam:"="},link:function(a,b){a.dropDownOptions=function(b,c,d){var e=a.getDropDownDataSource(b,c,d);return{dataTextField:"value",dataValueField:"value",dataSource:e,index:a.getCurrentDropDownIndex(b,c,e),change:function(d){a.$parent.$parent.$parent.$parent.submitListCellAction(b,c,d)}}},a.getDropDownDataSource=function(a,b,c){var d,e=b.getActionParameter();if(e.hasDependencies()){var f={},g=e.getDependenciesIds(),h=(a.id,a);angular.forEach(g,function(a){f[a]=h.data[a]}),d=e.getAllowedMembersForParameterizedList(f,this.actionId).then(function(a){return a})["finally"](function(){})}else d=e.getAllowedMembersWithoutInputDependencies(c.dataItemId,a.id);return d},a.getCurrentDropDownIndex=function(a,b,c){var d=a.data[b.dataItemColumnId],e=null;for(var f in c)if(c[f].value==d){e=c[f].id;break}return e=parseInt(e),e-1},a.submitListCellAction=function(b,c,d){var e=d.sender.element.context.value,f=d.sender.element;e=a.translateValueToId(e,f),this.executeCellAction(b,c,e)},a.translateValueToId=function(a,b){if(b.length>0){var c=b.data("kendoDropDownList").dataSource.data();angular.forEach(c,function(b){return b.value==a?void(a=b.id):void 0})}return a},a.dropDownList=$(b).kendoDropDownList(a.dropDownOptions(a.rowParam,a.columnParam,a.tabParam)),a.$on("current-list-item-updated",function(a,b){var c=a.currentScope.dropDownList;if("secondLayerDropDown"==$(c).attr("id")){var d=a.currentScope.columnParam,e=a.currentScope.tabParam,f=$(c).data("kendoDropDownList"),g=a.currentScope.dropDownOptions(b,d,e);f.options=g,f.dataSource.read();g.dataSource;f.refresh();var h=g.index;f.select(h)}}.bind(this))}}}]),angular.module("skyGiraffeApp").factory("List",["$rootScope",function(a){function b(a){this.list=this.populateList(a.Template)}return b.prototype.populateList=function(a){return{sectionSourceColumnId:a.SectionSourceColumnID}},b.prototype.setCurrentListItem=function(b,c){this.tab.list.currentRow=b,a.$broadcast("current-list-item-updated",b)},b.prototype.isOneLayerList=function(){var a=!0,b=this.tab.columns;for(var c in b)if(!b[c].isPrimary){a=!1;break}return a},b}]),angular.module("skyGiraffeApp").controller("CardsCtrl",["$scope","Cards",function(a,b){}]),angular.module("skyGiraffeApp").directive("cards",["SGConfig","Slicer","slicerService",function(a,b,c){var d=function(a){this.tab=a,this.data=a.data,this.dataSource=null};return d.prototype.buildDataSource=function(){var a=new kendo.data.DataSource({data:this.data});return a},d.prototype.populateRenderScope=function(a){a.rows=this.dataSource.view(),a.cardDataMappings=this.tab.cards},{templateUrl:"views/partials/_cards.html",controller:"CardsCtrl",restrict:"E",replace:!0,scope:{options:"="},link:function(a,b,c){var e=new d(a.options.tab);e.dataSource=e.buildDataSource(),e.dataSource.fetch(function(){e.populateRenderScope(a)})}}}]),angular.module("skyGiraffeApp").factory("Cards",["SGConfig","Slicer",function(a,b){function c(a){this.cards=this.populateCard(a.Template),this.data=this.getData()}return c.prototype.populateCard=function(a){var b=a.CardMappings[0].ElementMappings,c=b[0].GridColumnID,d=b[1].GridColumnID,e=b[2].GridColumnID,f=b[3].GridColumnID;return{iconColumnId:c,cardTitleColumnId:d,lastUpdateColumnId:e,statusColumnId:f}},c.prototype.generateSlicers=function(a){var c=[];for(var d in a){var e=b.find(d),f=e.findSourceColumnForTab(this.id),g=this.getDataColumnIdByDataItemColumnId(f),h=a[d];if("(ALL)"!=h&&("object"!=typeof h||0!=h.length)){var i=[];if("object"==typeof h)for(var j in h)i.push({field:g,operator:"eq",value:h[j]});else i.push({field:g,operator:"eq",value:h});var k={logic:"or",filters:i};c.push(k)}}return c},c}]),angular.module("skyGiraffeApp").directive("coverFlow",["SGConfig","Slicer","slicerService",function(a,b,c){var d=function(a){this.tab=a,this.data=a.data,this.dataSource=null};return d.prototype.buildDataSource=function(){var a=new kendo.data.DataSource({data:this.data});return a},d.prototype.populateRenderScope=function(a){a.rows=this.dataSource.view(),a.coverFlowDataMappings=this.tab.cards},{templateUrl:"views/partials/_cover-flow.html",controller:"CoverFlowCtrl",restrict:"E",replace:!0,scope:{options:"="},link:function(a,b,c){var e=new d(a.options.tab);e.dataSource=e.buildDataSource(),e.dataSource.fetch(function(){e.populateRenderScope(a)})}}}]),angular.module("skyGiraffeApp").controller("CoverFlowCtrl",["$scope","Cards",function(a,b){}]),angular.module("skyGiraffeApp").factory("CoverFlow",function(){function a(){}return a.prototype.getGridColumns=function(a){var b=a.Template.GridColumns;if("CoverFlow"==a.Template.Type){var c,d,e=a.Template.SectionSourceColumnID;null!=e&&(c=this.getDataItem().getColumn(e),d={ActionID:null,AdditionalData1:null,AdditionalData2:null,ColumnFormat:null,ColumnFriendlyName:c.name,ColumnType:"Text",DataItemColumnID:c.id,DataType:c.type,ID:"G"+c.id,IsFrozen:!1,IsPrimary:!1,IsVisible:!0,Navigation:null,Ordnial:-1,SlicerID:null,SparkChart:null,TrendsDataItemColumnID:null});var f,g,h=a.Template.HeaderImageColumnID;null!=h&&(f=this.getDataItem().getColumn(h),g={ActionID:null,AdditionalData1:null,AdditionalData2:null,ColumnFormat:null,ColumnFriendlyName:f.name,ColumnType:"Image",DataItemColumnID:f.id,DataType:f.type,ID:"G"+f.id,IsFrozen:!1,IsPrimary:!1,IsVisible:!0,Navigation:null,Ordnial:0,SlicerID:null,SparkChart:null,TrendsDataItemColumnID:null}),null!=g&&b.unshift(g),null!=d&&b.unshift(d)}return b},a}),angular.module("skyGiraffeApp").factory("APPSettings",["SGConfig","User",function(a,b){function c(a){}return c.capitalizeFirstLetter=function(a){return a.charAt(0).toUpperCase()+a.slice(1)},c.changePassword=function(){},c.getOrganization=function(){return"Sky Giraffe QA"},c}]),angular.module("skyGiraffeApp").controller("SettingsGeneralCtrl",["$scope","$routeParams","APPSettings","SGConfig",function(a,b,c,d){a.settingName=c.capitalizeFirstLetter(b.setting_name),a.settingsList=[{name:"User Settings",items:[{name:"Login",value:"",type:"text",isShown:!0},{name:"Login Time",value:"",type:"text",isShown:!1},{name:"Remember Me",value:!1,type:"switcher",isShown:!1},{name:"Change Password",value:c.changePassword,type:"action",isShown:!1}]},{name:"Server Settings",items:[{name:"External Credentials",value:"",type:"action",isShown:!1},{name:"Organization",value:"",type:"text",isShown:!1},{name:"Connection Timeout",value:[30,60,90,120],type:"options",isShown:!1},{name:"Send parameter by e-mail",value:!1,type:"switcher",isShown:!1}]},{name:"About",items:[{name:"Credits",value:"",type:"action",isShown:!0},{name:"Privacy policy",value:"",type:"action",isShown:!0},{name:"Version",value:d.version,type:"action",isShown:!0}]}]}]),angular.module("skyGiraffeApp").directive("generalSettings",["SGConfig","Slicer","slicerService","$timeout",function(a,b,c,d){var e=function(a){};return{templateUrl:"views/settings/_general.html",restrict:"E",replace:!0,controller:"SettingsGeneralCtrl",scope:{
options:"="},link:function(a,b,c){new e;d(function(){$("[data-component]").kendoPanelBar().data("kendoPanelBar")},0)}}}]),angular.module("skyGiraffeApp").factory("Action",["Populator","Parameter","DataItem","$http","SGConfig","Server",function(a,b,c,d,e,f){function g(a){this.id=a.ID,this.name=a.ActionName,this.type=a.ActionLocation,this.labels=a.ActionLabels,this.parameters=b.add(a.ActionParameters),this.buttonText=a.ButtonText}return g.records={},g.addInGrid=function(a){return g.add(a,"InGrid")},g.addOutGrid=function(a){return g.add(a,"OutGrid")},g.add=function(a,b){var c={};for(var d in a)if("undefined"==typeof b||a[d].ActionLocation==b){var e=new g(a[d]);c[e.id]=e,this.records[e.id]=e}return c},g.find=function(a){return this.records[a]},g.prototype.fetch=function(){var a=f.request(e.urls.getAction,{ActionID:this.id}).success(function(a,b,d,f){e.validateStatus(a.Status).isValid&&c.add(a.Data)});return a},g}]),angular.module("skyGiraffeApp").service("actionService",["$q","$modal",function(a,b){this.open=function(c,d,e,f,g){var h=b.open({animation:!0,backdrop:"static",templateUrl:"views/parametersmodal.html",controller:"ParametersModalCtrl",resolve:{data:function(){return{title:e.name,parameters:e.parameters,sourceDataItemId:g,actionId:e.id,rowId:f}}}}),i=a.defer();return h.result.then(function(a){c.executeAction(d.id,e.id,a,f).then(function(){i.resolve()},function(a){i.reject(a)})}),i.promise}}]),angular.module("skyGiraffeApp").service("tableParameterService",["$q","$modal",function(a,b){this.open=function(c,d,e,f){var g=b.open({animation:!0,backdrop:"static",templateUrl:"views/tableparametersmodal.html",controller:"TableParameterCtrl",resolve:{data:function(){return{parameters:c,title:d,parameterId:e,parameterItems:f}}}}),h=a.defer();return g.result.then(function(a){h.resolve(a)}),h.promise}}]),angular.module("skyGiraffeApp").controller("TableParameterCtrl",["$scope","$modalInstance","data","SGConfig","tableParameterRowService","Parameter",function(a,b,c,d,e,f){a.title=c.title,a.tableParameterParameters=[];for(var g in c.parameters)a.tableParameterParameters.push(c.parameters[g]);a.tableParameterItems=[];for(var h in c.parameterItems)a.tableParameterItems.push(c.parameterItems[h]);a.ok=function(){b.close({tableParameterItems:a.tableParameterItems,parameterId:c.parameterId})},a.addRow=function(){e.open(a.tableParameterParameters,a.title).then(function(a){this.tableParameterItems.push(a)}.bind(this),function(a){d.log(a)})},a.editRow=function(b,c){e.open(a.tableParameterParameters,a.title,b,c).then(function(a){this.tableParameterItems[a.itemIndex]=a}.bind(this),function(a){d.log(a)})},a.deleteRow=function(b){var c=a.tableParameterItems.indexOf(b);c>-1&&a.tableParameterItems.splice(c,1)},a.cancel=function(){try{b.dismiss()}catch(a){}}}]),angular.module("skyGiraffeApp").service("tableParameterRowService",["$q","$modal",function(a,b){this.open=function(c,d,e,f){var g=b.open({animation:!0,backdrop:"static",templateUrl:"views/tableparameterrowmodal.html",controller:"TableParameterRowCtrl",resolve:{data:function(){return{parameters:c,title:d,item:e,itemIndex:f}}}}),h=a.defer();return g.result.then(function(a){h.resolve(a)}),h.promise}}]),angular.module("skyGiraffeApp").controller("TableParameterRowCtrl",["$scope","$modalInstance","data","SGConfig","Parameter",function(a,b,c,d,e){if(a.title=c.title,a.parameters=c.parameters,a.itemIndex=c.itemIndex,a.choices={},null!=c.item)for(var f in a.parameters)a.choices[a.parameters[f].id]=c.item[a.parameters[f].id];a.ok=function(){a.choices.itemIndex=a.itemIndex,b.close(a.choices)},a.addRow=function(c){b.close({parameterId:c,table:a.table})},a.cancel=function(){try{b.dismiss()}catch(a){}}}]),angular.module("skyGiraffeApp").factory("Parameter",["DataItem","SGConfig","Server","$q",function(a,b,c,d){function e(a){this.id=a.ID,this.name=a.ParameterName,this.order=a.Ordinal,this.type=a.ParameterType,this.allowedMembers=a.AllowedMembers,this.dataItemId=a.DataItemID,this.dataType=a.DataType,this.dynamicCollectionSource=this.populateDynamicCollectionSource(a.DynamicCollectionSource),this.inputType=a.InputType,this.isMandatory=a.IsMandatory,this.isMultiSelect=a.IsMultiSelect,this.labelStyle=a.LabelStyle,this.defaultValue=a.ParameterDefaultValue,this.mappings=this.populateMappings(a.ParameterMappings),this.tableParameterData=e.add(a.TableParameters),this.imageSize=a.ImageSize,this.placeholder=a.Placeholder,this.searchboxMapToParameterName=a.SearchboxMapToParameterName}return e.records={},e.add=function(a){var b={};for(var c in a){var d=new e(a[c]);b[d.id]=d,this.records[d.id]=d}return b},e.find=function(a){return this.records[a]},e.prototype.getAllowedMembersWithoutInputDependencies=function(a,b){switch(this.type){case"List":return this.populateAllowedMembersFromList(this.allowedMembers);case"DataItemSimpleList":return this.populateAllowedMembersFromDataItem(this.dataItemId);case"DynamicCollection":return this.getAllowedMembersForRow(a,b)}},e.prototype.getAllowedMembersWithInputDependencies=function(a,b){switch(this.type){case"DynamicCollection":var c=Object.keys(a)[0],d=a[c];return this.getAllowedMembersBasedOnAnotherParameter(d);case"ParameterizedList":return this.getAllowedMembersForParameterizedList(a,b)}},e.prototype.populateAllowedMembersFromList=function(a){var b=[];for(var c in a){var d={id:a[c].ID,value:a[c].Value,isDefault:a[c].IsDefault};b.push(d)}return b},e.prototype.populateAllowedMembersFromDataItem=function(b,c){var d=a.find(b);if("undefined"!=typeof d){if("undefined"!=typeof c)var e=d.selectByColumn("ParentID",c);else var e=d.rows;var f=[];for(var g in e){var h=d.rows[g].data,i={};for(var j in d.columns){var k=d.columns[j],l=this.translateAllowedMembersColumnName(k.name);i[l]=h[k.id]}f.push(i)}return f}},e.prototype.getAllowedMembersForRow=function(b,c){if("Column"==this.dynamicCollectionSource.sourceType){var d=a.find(b),e=this.dynamicCollectionSource.id,f=d.rows[c].data[e],g=this.populateAllowedMembersFromDataItem(this.dataItemId,f);return g}},e.prototype.getAllowedMembersBasedOnAnotherParameter=function(a){var b=d.defer(),c=this.populateAllowedMembersFromDataItem(this.dataItemId,a);return b.resolve(c),b.promise},e.prototype.getAllowedMembersForParameterizedList=function(e,f,g,h){var i=[];for(var j in this.mappings){var k=this.mappings[j];i.push({ParameterName:k.mappedParameterName,ValueID:e[k.sourceId]})}null!=g&&i.push({ParameterName:g,ValueID:h});var l={ActionID:f,ParameterID:this.id,Parameters:i},m=d.defer(),n=this;return c.request(b.urls.parameterizedParameter,l).success(function(c,d,e,f){if(b.validateStatus(c.Status).isValid){var g=a.addRecord(c.Data),h=n.populateAllowedMembersFromDataItem(g.id);m.resolve(h)}else m.reject()}),m.promise},e.prototype.isHidden=function(){return this.isGPSLocation()||this.isLogin()||this.isMobileDateTime()},e.prototype.isFreeText=function(){return"FreeText"==this.type||"QRScanner"==this.type},e.prototype.isGPSLocation=function(){return"GPSLocation"==this.type},e.prototype.isLogin=function(){return"Login"==this.type},e.prototype.isMobileDateTime=function(){return"MobileDateTime"==this.type},e.prototype.isDate=function(){return"FreeText"==this.type&&"System.DateTime"==this.dataType},e.prototype.isTable=function(){return"Table"==this.type},e.prototype.isSearchbox=function(){return null!=this.searchboxMapToParameterName},e.prototype.isImage=function(){return"Image"==this.type},e.prototype.isSignature=function(){return"Signature"==this.type},e.prototype.isDynamicCollection=function(){return"DynamicCollection"==this.type},e.prototype.isSystemVariable=function(){return this.isLogin()||this.isMobileDateTime()||this.isGPSLocation()},e.prototype.hasDependencies=function(){var a=!1;return"undefined"!=typeof this.mappings?a=!0:"undefined"!=typeof this.dynamicCollectionSource&&"Parameter"==this.dynamicCollectionSource.sourceType&&(a=!0),a},e.prototype.getDependenciesIds=function(){return"undefined"!=typeof this.mappings?this.mappings.map(function(a){return"Login"==a.sourceType?"Login":a.sourceId}):[this.dynamicCollectionSource.id]},e.prototype.translateAllowedMembersColumnName=function(a){switch(a){case"ItemID":return"id";case"ItemName":return"value";case"IsDefault":return"isDefault"}},e.prototype.getDataItem=function(b){return a.find(this.dataItemId)},e.prototype.populateDynamicCollectionSource=function(a){return null!=a?{id:a.ID,sourceType:a.SourceType}:void 0},e.prototype.populateMappings=function(a){if(null!=a){var b=[];for(var c in a){var d={mappedParameterName:a[c].MapToParameterName,sourceId:a[c].SourceID,sourceType:a[c].SourceType};b.push(d)}return b}},e}]),angular.module("skyGiraffeApp").directive("parameter",["$modal","$compile",function(a,b){var c=function(a,b){this.scope=a,this.element=b};return c.prototype.BuildFreeText=function(){if(this.scope.parameter.isDate()){var a=this.element.kendoDatePicker({close:function(a){setTimeout(function(){a.sender.element.blur()})},format:"MMM-dd-yyyy"});a.bind("focus",function(){$(this).parent().parent().removeClass("ng-dirty"),$(this).data("kendoDatePicker").open()}),this.buildMobileDateTime("short")}else this.element.addClass("k-textbox"),null!=this.scope.parameter.placeholder&&this.element.attr("placeholder",this.scope.parameter.placeholder)},c.prototype.buildMobileDateTime=function(a){var b=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],c=new Date,d=c.getDate(),e=b[c.getMonth()],f=c.getFullYear(),g=c.getHours(),h=c.getMinutes(),i=c.getSeconds();10>d&&(d="0"+d),10>g&&(g="0"+g),10>h&&(h="0"+h),10>i&&(i="0"+i);var j=e+"-"+d+"-"+f+" "+g+":"+h+":"+i;_.isUndefined(a)||_.isNull(a)||"short"==a&&(j=e+"-"+d+"-"+f),this.scope.bindTo[this.scope.parameter.id]=j},{template:'<input ng-model="bindTo[parameter.id]" class="parameter" ng-required="parameter.isMandatory"/>',replace:!0,restrict:"E",scope:{parameter:"=parameter",sourceDataItemId:"=",actionId:"=",rowId:"=",bindTo:"="},link:function(a,b,d,e){var f=new c(a,b);if(b.attr("id",a.parameter.id),a.parameter.isHidden()&&b.attr("type","hidden"),null!=a.parameter.defaultValue&&""!=a.parameter.defaultValue&&(a.bindTo[a.parameter.id]=a.parameter.defaultValue),a.parameter.isFreeText())f.BuildFreeText();else if(a.parameter.isGPSLocation())a.bindTo[a.parameter.id]="0,0",navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(b){a.$apply(function(){a.bindTo[a.parameter.id]=String(b.coords.latitude)+","+String(b.coords.longitude)})});else if(a.parameter.isMobileDateTime())f.buildMobileDateTime();else if(a.parameter.isLogin())a.bindTo[a.parameter.id]="";else if(a.parameter.isTable())b.attr("type","hidden");else if(a.parameter.isSearchbox())b.attr("type","hidden");else if(a.parameter.isImage())b.attr("type","file"),b.attr("id","fileInput"),b.removeAttr("bind-to"),b.removeAttr("ng-model"),a.bindTo[a.parameter.id]="",b.attr("onchange","angular.element(this).scope().loadImageToCanvas(angular.element(this).scope().parameter.id)");else if(a.parameter.isSignature())b.attr("type","hidden");else{if(a.parameter.hasDependencies())a.$watchCollection("bindTo",function(b,c){var d=a.parameter.getDependenciesIds(),e={};angular.forEach(d,function(b){"Login"==b&&(e[b]=""),"undefined"!=typeof a.bindTo[b]&&(e[b]=a.bindTo[b])}),Object.keys(e).length==d.length&&(kendo.ui.progress(a.dropDown.wrapper,!0),a.dropDown.enable(!1),a.parameter.getAllowedMembersWithInputDependencies(e,a.actionId).then(function(b){a.dropDown.dataSource.data(b);for(var c in b)if(1==b[c].isDefault){a.dropDown.select(parseInt(c));break}a.bindTo[a.parameter.id]!=a.dropDown.value()&&(a.bindTo[a.parameter.id]=a.dropDown.value())})["finally"](function(){kendo.ui.progress(a.dropDown.wrapper,!1),a.dropDown.enable(!0)}))});else var g=a.parameter.getAllowedMembersWithoutInputDependencies(a.sourceDataItemId,a.rowId);var h=[];h.push({id:"0",isDefault:"0",value:"Select All"});for(var i in g)h.push(g[i]);g=h;var j={dataTextField:"value",dataValueField:"id",dataSource:g};for(var k in g)if(1==g[k].isDefault){j.index=parseInt(k);break}if(null!=j.index&&void 0!=j.index||(j.index=-1),a.parameter.isMultiSelect){j.change=function(b){a.$apply(function(){if(_.contains(b.sender.value(),"0")){var c=$.map(b.sender.dataSource.data(),function(a){return a.id});c=_.without(c,_.findWhere(c,"0")),a.bindTo[a.parameter.id]=c.join(",")}else a.bindTo[a.parameter.id]=b.sender.value().join(",")})};var l=b.kendoMultiSelect(j);a.dropDown=l.data("kendoMultiSelect")}else{var l=b.kendoDropDownList(j);l.change(),a.dropDown=l.data("kendoDropDownList")}}}}}]),angular.module("skyGiraffeApp").controller("ParametersModalCtrl",["$scope","$modalInstance","data","SGConfig","tableParameterService","searchboxService",function(a,b,c,d,e,f){a.title=c.title,a.parameters=c.parameters,a.actionId=c.actionId,a.atLeastOneParameterIsMandatory=c.atLeastOneParameterIsMandatory,a.sourceDataItemId=c.sourceDataItemId,a.rowId=c.rowId,a.inputParameterChoices=c.parameterChoices,a.choices={},null!=a.inputParameterChoices&&(a.choices=a.inputParameterChoices),a.complexChoices={},a.ok=function(){a.saveSignature();var c=a.checkIfAllMandatoryFieldsAreFilled();return a.atLeastOneParameterIsMandatory?void alert("At least one parameter must be filled."):void(c&&b.close(a.choices))},a.cancel=function(){try{b.dismiss()}catch(a){}},a.editTable=function(a){e.open(this.parameters[a].tableParameterData,this.parameters[a].name,a,this.choices[a]).then(function(a){this.choices[a.parameterId]=a.tableParameterItems}.bind(this),function(){})},a.openSearchBox=function(a,b){f.open(a,b).then(function(a){this.complexChoices[a.parameterId]=a.searchboxResult,this.choices[a.parameterId]=a.searchboxResult.id}.bind(this),function(){})},a.loadImageToCanvas=function(b){var c=a.parameters[b].imageSize,e=document.getElementById("canvas").getContext("2d"),f=new FileReader,g=document.getElementById("fileInput").files[0],h=new Image;h.onload=function(){var f;if("Small"==c?f=100:"Medium"==c?f=200:"Large"==c?f=300:(f=100,d.log("Unsupported image size")),h.width>=h.height){var g=f/h.width;e.canvas.width=f,e.canvas.height=h.height*g}else if(h.width<h.height){var g=f/h.height;e.canvas.height=f,e.canvas.width=h.width*g}e.drawImage(h,0,0,e.canvas.width,e.canvas.height);var i=e.canvas.toDataURL(),j=i.indexOf(",")+1,k=i.substring(j),l=a.convertFromBase64ToHex(k);l=l.replace(/\s/g,""),this.choices[b]=l,angular.element(document.getElementById("fileInput")).scope().$destroy()}.bind(this),f.onloadend=function(){h.src=f.result},f.readAsDataURL(g)},a.convertFromBase64ToHex=function(a){if(!window.atob){var b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";b.split("");window.atob=function(a){if(/(=[^=]+|={3,})$/.test(a))throw new Error("String contains an invalid character");a=a.replace(/=/g,"");var c=3&a.length;if(1===c)throw new Error("String contains an invalid character");for(var d=0,e=0,f=a.length/4,g=[];f>d;++d){var h=b.indexOf(a[e++]||"A"),i=b.indexOf(a[e++]||"A"),j=b.indexOf(a[e++]||"A"),k=b.indexOf(a[e++]||"A");if(0>(h|i|j|k))throw new Error("String contains an invalid character");g[g.length]=255&(h<<2|i>>4),g[g.length]=255&(i<<4|j>>2),g[g.length]=255&(j<<6|k)}return String.fromCharCode.apply(null,g).substr(0,g.length+c-4)}}for(var c=0,d=atob(a.replace(/[ \r\n]+$/,"")),e=[];c<d.length;++c){var f=d.charCodeAt(c).toString(16);1===f.length&&(f="0"+f),e[e.length]=f}return e.join(" ")},a.clearCanvas=function(){var a=document.getElementById("signature"),b=a.getContext("2d");b.clearRect(0,0,a.width,a.height)},a.saveSignature=function(){var b=document.getElementById("signature");if(null!=b){var c=b.getContext("2d"),d=c.canvas.toDataURL(),e=d.indexOf(",")+1,f=d.substring(e),g=a.convertFromBase64ToHex(f);g=g.replace(/\s/g,"");var h=angular.element(document.getElementById("signature")).scope().$parent.parameter.id;a.choices[h]=g}},a.checkIfAllMandatoryFieldsAreFilled=function(){var b=!0,c={},d={},e=a.choices;for(var f in a.parameters)a.parameters[f].isMandatory&&(c[f]=a.parameters[f]);for(var f in c)if(null==e[f]||""==e[f]){d[f]=c[f];var g=$("#"+f);d[f].isDate()?g=g.parent().parent():d[f].isDynamicCollection()&&(g=g.parent()),g.hasClass("ng-dirty")||g.addClass("ng-dirty"),d[f].isLogin()||(b=!1)}return b},a.autoSubmitIfAllParametersAreSystemVariables=function(){var a=!0,b=this.parameters;for(var c in b)b[c].isSystemVariable()||(a=!1);return a?(d.log("Autosubmitting parameters (since all parameters are system variables."),this.ok(),!0):!1},a.autoSubmitIfAllParametersAreFilledOnNavigation=function(){var a=!0,b=this.parameters;for(var c in b)null!=this.inputParameterChoices&&null==this.inputParameterChoices[c]?a=!1:null==this.inputParameterChoices&&(a=!1);a&&(d.log("Autosubmitting parameters (since all parameters were filled."),this.ok())},setTimeout(function(){var a=this.autoSubmitIfAllParametersAreSystemVariables();a||this.autoSubmitIfAllParametersAreFilledOnNavigation()}.bind(a))}]),angular.module("skyGiraffeApp").service("parameterService",["$q","$modal",function(a,b){this.open=function(c,d){var e=b.open({animation:!0,backdrop:"static",templateUrl:"views/parametersmodal.html",controller:"ParametersModalCtrl",resolve:{data:function(){return{title:c.name,parameters:c.parameters,parameterChoices:d,atLeastOneParameterIsMandatory:c.atLeastOneParameterIsMandatory}}}}),f=a.defer();return e.result.then(function(a){c.fetchParameterized(a).success(function(){f.resolve()})},function(){setTimeout(function(){f.reject()},300)}),f.promise}}]),angular.module("skyGiraffeApp").service("searchboxService",["$q","$modal",function(a,b){this.open=function(c,d){var e=b.open({animation:!0,backdrop:"static",templateUrl:"views/searchboxmodal.html",controller:"SearchboxCtrl",resolve:{data:function(){return{parameter:c,choices:d}}}}),f=a.defer();return e.result.then(function(a){f.resolve(a)}),f.promise}}]),angular.module("skyGiraffeApp").controller("SearchboxCtrl",["$scope","$modalInstance","data","SGConfig","tableParameterRowService","Parameter",function(a,b,c,d,e,f){a.searchParameter="",a.parameter=c.parameter,a.choices=c.choices,a.title=c.parameter.name,a.listItems,a.ok=function(a){b.close({searchboxResult:a,parameterId:c.parameter.id})},a.search=function(b){var c=a.parameter.getDependenciesIds(),d={};angular.forEach(c,function(b){"Login"==b&&(d[b]=""),"undefined"!=typeof a.choices[b]&&(d[b]=a.choices[b])}),a.parameter.getAllowedMembersForParameterizedList(d,null,a.parameter.searchboxMapToParameterName,b).then(function(b){a.listItems=b})},a.cancel=function(){try{b.dismiss()}catch(a){}}}]),angular.module("skyGiraffeApp").directive("signature",function(){return{restrict:"A",link:function(a,b){function c(a,b,c,d){f.moveTo(a,b),f.lineTo(c,d),f.strokeStyle="#000000",f.stroke()}b[0].width=angular.element(b).parent()[0].clientWidth;var d,e,f=b[0].getContext("2d"),g=!1;b.bind("mousedown",function(a){void 0!==a.offsetX?(d=a.offsetX,e=a.offsetY):(d=a.layerX-a.currentTarget.offsetLeft,e=a.layerY-a.currentTarget.offsetTop),f.beginPath(),g=!0}),b.bind("mousemove",function(a){var b,f;g&&(void 0!==a.offsetX?(b=a.offsetX,f=a.offsetY):(b=a.layerX-a.currentTarget.offsetLeft,f=a.layerY-a.currentTarget.offsetTop),c(d,e,b,f),d=b,e=f)}),b.bind("mouseup",function(a){g=!1})}}}),angular.module("skyGiraffeApp").factory("Slicer",function(){function a(a){this.id=a.ID,this.members=a.Members,this.name,this.isMultiSelect,this.mappings}return a.records={},a.add=function(b,c){var d={};for(var e in b){var f=new a(b[e]);for(var g in c)f.id==c[g].ID&&f.setAdditionalData(c[g]);d[f.id]=f,this.records[f.id]=f}return d},a.find=function(b){return a.records[b]},a.resolve=function(a,b){var c={};for(var d in b){var e=b[d],f=a[e.value];"(ALL)"!=e.value&&(c[e.slicerId]=f)}return c},a.prototype.setAdditionalData=function(a){this.mappings=this.populateMappings(a.SlicerMappings),this.name=a.FriendlyName,this.isMultiSelect=!a.SingleSelect,this.formatMembers()},a.prototype.populateMappings=function(a){var b=[];for(var c in a)b.push({sourceColumn:a[c].SourceDataItemColumn,tabId:a[c].TabID});return b},a.prototype.findSourceColumnForTab=function(a){for(var b in this.mappings)if(this.mappings[b].tabId==a)return this.mappings[b].sourceColumn},a.prototype.formatMembers=function(){this.isMultiSelect&&(this.members=_.reject(this.members,function(a){return"(ALL)"==a})),this.members=_.sortBy(this.members,function(a){return a})},a}),angular.module("skyGiraffeApp").controller("SlicersModalCtrl",["$scope","$modalInstance","data","SGConfig",function(a,b,c,d){a.tab=c.tab,a.reportSlicers=c.reportSlicers,a.reportSlicerChoices=$.extend(!0,{},c.reportSlicerChoices),a.tabSlicerChoices=$.extend(!0,{},c.tabSlicerChoices),d.log(a.reportSlicerChoices);var e=_.invoke(a.reportSlicers,"findSourceColumnForTab",a.tab.id);a.tabSlicers=_.reject(a.tab.columns,function(a){return _.contains(e,a.dataItemColumnId)}),a.ok=function(){b.close({reportSlicerChoices:a.reportSlicerChoices,tabSlicerChoices:a.tabSlicerChoices})},a.cancel=function(){try{b.dismiss()}catch(a){}}}]),angular.module("skyGiraffeApp").directive("slicer",["$filter",function(a){return{template:'<input required k-ng-model="bindTo[slicer.id]" class="slicer" />',replace:!0,restrict:"E",scope:{slicer:"&",members:"&",bindTo:"=",reportSlicer:"&"},link:function(a,b,c){var d=a.slicer(),e=a.bindTo[d.id]||[];b.attr("id",d.id);var f={template:function(a){var b=a;return'<span class="k-state-default" style="font-weight:bold;">'+b+"</span>"}.bind({slicer:d,element:b}),value:e,autoClose:!1},g=[];g.push("Select All");var h=a.members();for(var i in h)g.push(h[i]);h=g,f.dataSource=h;var j=!1;1==a.reportSlicer()?d.isMultiSelect&&(j=!0):j=!0;var k;f.change=function(b){a.$apply(function(){if(_.contains(b.sender.value(),"Select All")){var c=$.map(b.sender.dataSource.data(),function(a){return a});c=_.without(c,_.findWhere(c,"Select All")),a.bindTo[d.id]=c}else a.bindTo[d.id]=b.sender.value()})},j?(k=b.kendoMultiSelect(f),a.dropDown=k.data("kendoMultiSelect")):(k=b.kendoDropDownList(f),a.dropDown=k.data("kendoDropDownList"))}}}]),angular.module("skyGiraffeApp").service("slicerService",["$q","$modal","$location","$rootScope",function(a,b,c,d){this.reportSlicerChoices={},this.tabSlicerChoices={},this.open=function(c,e){var f=b.open({animation:!0,backdrop:"static",templateUrl:"views/slicersmodal.html",controller:"SlicersModalCtrl",resolve:{data:function(){return{tab:e,reportSlicers:c.slicers,reportSlicerChoices:this.reportSlicerChoices,tabSlicerChoices:this.tabSlicerChoices}}.bind(this)}}),g=a.defer(),h=this;return f.result.then(function(a){h.reportSlicerChoices=a.reportSlicerChoices,h.tabSlicerChoices=a.tabSlicerChoices,d.$broadcast("slicers-updated")}),g.promise},this.setFromUrl=function(){if(c.search().slicers){var a=c.search().slicers;this.reportSlicerChoices=JSON.parse(decodeURIComponent(a))}},this.getSlicers=function(){return angular.extend({},this.reportSlicerChoices,this.tabSlicerChoices)},this.resetTabSlicerChoices=function(){this.tabSlicerChoices={}},this.getReportSlicerChoices=function(){return this.reportSlicerChoices},this.reset=function(){this.reportSlicerChoices={},this.tabSlicerChoices={}}}]),angular.module("skyGiraffeApp").factory("Navigation",function(){function a(a){this.mappings=this.populateNavigationMappings(a.NavigationMappings),this.parameters=this.populateParametersMappings(a.NavigationParametersMappings),this.reportId=a.OpenReport,this.tabId=a.OpenTemplate}return a.records={},a.add=function(b){var c={};for(var d in b){var e=new a(b[d]);c[e.id]=e,this.records[e.id]=e}return c},a.find=function(a){return this.records[a]},a.prototype.populateNavigationMappings=function(a){var b=[];for(var c in a)b.push({slicerId:a[c].SlicerID,value:a[c].Value});return b},a.prototype.populateParametersMappings=function(a){var b=[];for(var c in a)b.push({parameterId:a[c].ReportParameterID,dataItemColumnId:a[c].DataItemColumnID});return b},a});